# å®Ÿè£…æ–¹é‡

## ğŸ“‹ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå | å®Ÿè£…æ–¹é‡ |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | 1.1 |
| ä½œæˆæ—¥ | 2025-12-28 |
| ä½œæˆè€… | App-Architect |

---

## ğŸ¯ å®Ÿè£…æ–¹é‡ã®ç›®çš„

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ Coder ã¸ã®å¼•ãç¶™ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚**

- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’æ˜ç¢ºåŒ–
- å‘½åè¦å‰‡ã‚’çµ±ä¸€
- ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã‚’æ˜ç¤º
- å®Ÿè£…æ™‚ã®æ³¨æ„äº‹é …ã‚’è¨˜è¼‰

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

### æ¨å¥¨æ§‹æˆï¼ˆæŠ€è¡“æ¨™æº–æº–æ‹ ï¼‰

```
demo-api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                      # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                         # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ routes.py                # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®šç¾©
â”‚   â”‚   â””â”€â”€ controllers/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ health_controller.py
â”‚   â”‚       â”œâ”€â”€ simulate_controller.py
â”‚   â”‚       â”œâ”€â”€ items_controller.py
â”‚   â”‚       â””â”€â”€ admin_controller.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                    # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ tenant_service.py
â”‚   â”‚   â”œâ”€â”€ items_service.py
â”‚   â”‚   â””â”€â”€ monitoring_service.py
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/                # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ items_repository.py
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                      # SQLAlchemy Model
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ item.py
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/              # æ¨ªæ–­çš„é–¢å¿ƒäº‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ datadog_middleware.py
â”‚   â”‚   â”œâ”€â”€ error_handler.py
â”‚   â”‚   â””â”€â”€ logger.py
â”‚   â”‚
â”‚   â””â”€â”€ config/                      # è¨­å®šç®¡ç†
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ settings.py
â”‚
â”œâ”€â”€ tests/                           # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ unit/                        # å˜ä½“ãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ test_items_service.py
â”‚   â”‚   â””â”€â”€ test_tenant_service.py
â”‚   â”œâ”€â”€ integration/                 # çµåˆãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â””â”€â”€ test_items_api.py
â”‚   â””â”€â”€ e2e/                         # E2Eãƒ†ã‚¹ãƒˆ
â”‚       â””â”€â”€ test_health_check.py
â”‚
â”œâ”€â”€ Dockerfile                       # Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
â”œâ”€â”€ requirements.txt                 # Python ä¾å­˜é–¢ä¿‚
â”œâ”€â”€ .env.example                     # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ .gitignore                       # Gité™¤å¤–è¨­å®š
â””â”€â”€ README.md                        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜
```

---

### é‡è¦åŸå‰‡

- âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†é›¢
- âœ… 1ãƒ•ã‚¡ã‚¤ãƒ«1ã‚¯ãƒ©ã‚¹/1é–¢æ•°ã®åŸå‰‡
- âŒ è²¬å‹™ã®ç•°ãªã‚‹å‡¦ç†ã‚’1ãƒ•ã‚¡ã‚¤ãƒ«ã«æ··åœ¨ã•ã›ãªã„

---

## ğŸ“ å‘½åè¦å‰‡

### ãƒ•ã‚¡ã‚¤ãƒ«å

| å¯¾è±¡ | å‘½åè¦å‰‡ | ä¾‹ |
|------|---------|-----|
| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆPythonãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ | ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ | `items_service.py` |
| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ | ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ | `api/controllers/` |
| ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« | `test_` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ + ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ | `test_items_service.py` |

---

### ã‚¯ãƒ©ã‚¹å

| å¯¾è±¡ | å‘½åè¦å‰‡ | ä¾‹ |
|------|---------|-----|
| ã‚¯ãƒ©ã‚¹ | ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ | `ItemsService`, `ItemsRepository` |
| ä¾‹å¤–ã‚¯ãƒ©ã‚¹ | ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ + `Error` ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ | `TenantNotFoundError` |
| SQLAlchemy Model | ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆå˜æ•°å½¢ï¼‰ | `Item` |

---

### é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰å

| å¯¾è±¡ | å‘½åè¦å‰‡ | ä¾‹ |
|------|---------|-----|
| é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ | `get_items()`, `validate_tenant()` |
| ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ | `_` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ + ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ | `_connect_db()` |
| éåŒæœŸé–¢æ•° | `async def` + ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ | `async def get_user()` |

---

### å¤‰æ•°å

| å¯¾è±¡ | å‘½åè¦å‰‡ | ä¾‹ |
|------|---------|-----|
| å¤‰æ•° | ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ | `tenant_id`, `item_count` |
| å®šæ•° | å¤§æ–‡å­—ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ | `MAX_RETRY_COUNT`, `DEFAULT_TIMEOUT` |
| ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå¤‰æ•° | `_` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ + ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ | `_db_session` |

---

## ğŸ¨ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### å‚ç…§ã™ã‚‹æŠ€è¡“æ¨™æº–

**å¿…é ˆå‚ç…§**:
- `.claude/docs/40_standards/41_app/languages/python.md` - Pythonè¦ç´„
- `.claude/docs/40_standards/49_common/security.md` - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæº–

---

### å‹ãƒ’ãƒ³ãƒˆï¼ˆå¿…é ˆï¼‰

**ã™ã¹ã¦ã®é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã«å‹ãƒ’ãƒ³ãƒˆã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚**

#### âœ… Good Example

```python
from typing import List, Optional

def get_items(tenant_id: str) -> List[Item]:
    """
    ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ã«ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

    å¼•æ•°:
        tenant_id (str): ãƒ†ãƒŠãƒ³ãƒˆID

    æˆ»ã‚Šå€¤:
        List[Item]: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆ
    """
    return items_repository.find_by_tenant(tenant_id)

def find_by_id(id: int) -> Optional[Item]:
    """
    ID ã§ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

    å¼•æ•°:
        id (int): ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ID

    æˆ»ã‚Šå€¤:
        Optional[Item]: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆæœªå­˜åœ¨ã®å ´åˆ Noneï¼‰
    """
    return items_repository.find_by_id(id)
```

---

#### âŒ Bad Example

```python
# âŒ å‹ãƒ’ãƒ³ãƒˆãªã—
def get_items(tenant_id):
    return items_repository.find_by_tenant(tenant_id)
```

---

### éåŒæœŸå‡¦ç†ï¼ˆI/Oå‡¦ç†ã§ã¯å¿…é ˆï¼‰

**I/Oå‡¦ç†ï¼ˆDBã€HTTPé€šä¿¡ç­‰ï¼‰ã§ã¯ `async/await` ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚**

#### âœ… Good Example

```python
from sqlalchemy.ext.asyncio import AsyncSession

async def get_items(tenant_id: str, db: AsyncSession) -> List[Item]:
    """
    éåŒæœŸã§ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

    I/Oå‡¦ç†ã®ãŸã‚ async/await ã‚’ä½¿ç”¨
    """
    result = await db.execute(select(Item).where(Item.tenant_id == tenant_id))
    return result.scalars().all()
```

---

#### âŒ Bad Example

```python
# âŒ I/Oå‡¦ç†ãªã®ã«åŒæœŸ
def get_items(tenant_id: str) -> List[Item]:
    result = db.execute(select(Item).where(Item.tenant_id == tenant_id))
    return result.scalars().all()
```

---

### Docstringï¼ˆå¿…é ˆï¼‰

**ã™ã¹ã¦ã®é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚¯ãƒ©ã‚¹ã« Docstringï¼ˆæ—¥æœ¬èªï¼‰ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚**

**å¿…é ˆé …ç›®**:
- ç›®çš„ãƒ»ç†ç”±
- å½±éŸ¿ç¯„å›²
- å‰ææ¡ä»¶

#### âœ… Good Example

```python
def validate_tenant(tenant_id: str) -> bool:
    """
    ãƒ†ãƒŠãƒ³ãƒˆIDã®æœ‰åŠ¹æ€§ã‚’æ¤œè¨¼

    ç›®çš„: ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ã‚’å®Ÿç¾ã—ã€ä¸æ­£ãªãƒ†ãƒŠãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢
    å½±éŸ¿ç¯„å›²: ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    å‰ææ¡ä»¶: VALID_TENANTS ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨

    å¼•æ•°:
        tenant_id (str): ãƒ†ãƒŠãƒ³ãƒˆID

    æˆ»ã‚Šå€¤:
        bool: æœ‰åŠ¹ãªå ´åˆ True

    ä¾‹å¤–:
        HTTPException: ç„¡åŠ¹ãªãƒ†ãƒŠãƒ³ãƒˆIDã®å ´åˆ
    """
    valid_tenants = settings.VALID_TENANTS.split(',')
    if tenant_id not in valid_tenants:
        raise HTTPException(status_code=400, detail="Invalid tenant")
    return True
```

---

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã‚’å®šç¾©ã—ã€é©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦ãã ã•ã„ã€‚**

#### âœ… Good Example

```python
# ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–å®šç¾©
class TenantNotFoundError(Exception):
    """ãƒ†ãƒŠãƒ³ãƒˆæœªå­˜åœ¨ã‚¨ãƒ©ãƒ¼"""
    pass

class ItemNotFoundError(Exception):
    """ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æœªå­˜åœ¨ã‚¨ãƒ©ãƒ¼"""
    pass

# ä½¿ç”¨ä¾‹
def get_item(tenant_id: str, id: int) -> Item:
    """
    ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

    ä¾‹å¤–:
        ItemNotFoundError: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„å ´åˆ
    """
    item = items_repository.find_by_id(tenant_id, id)
    if not item:
        raise ItemNotFoundError(f"Item {id} not found for tenant {tenant_id}")
    return item
```

---

#### âŒ Bad Example

```python
# âŒ None ã‚’è¿”ã™ï¼ˆã‚¨ãƒ©ãƒ¼ã‹ç©ºã‹ãŒåŒºåˆ¥ã§ããªã„ï¼‰
def get_item(id: int) -> Optional[Item]:
    item = items_repository.find_by_id(id)
    if not item:
        return None  # ã‚¨ãƒ©ãƒ¼ãªã®ã‹ã€ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„ã®ã‹ä¸æ˜
    return item
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹é‡

### ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

- **pytest**: ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™**: 80%ä»¥ä¸Š

---

### ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
tests/
â”œâ”€â”€ unit/                    # å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆå„ãƒ¬ã‚¤ãƒ¤ãƒ¼å˜ç‹¬ï¼‰
â”‚   â”œâ”€â”€ test_items_service.py
â”‚   â”œâ”€â”€ test_tenant_service.py
â”‚   â””â”€â”€ test_items_repository.py
â”œâ”€â”€ integration/             # çµåˆãƒ†ã‚¹ãƒˆï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼é–“é€£æºï¼‰
â”‚   â””â”€â”€ test_items_api.py
â””â”€â”€ e2e/                     # E2Eãƒ†ã‚¹ãƒˆï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå…¨ä½“ï¼‰
    â””â”€â”€ test_health_check.py
```

---

### ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆå˜ä½“ãƒ†ã‚¹ãƒˆï¼‰

```python
# tests/unit/test_items_service.py
import pytest
from services.items_service import ItemsService
from models.item import Item

@pytest.fixture
def items_service():
    return ItemsService()

def test_get_items_success(items_service, mocker):
    """
    ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ä¸€è¦§å–å¾—ã®æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ

    Arrange: ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
    Act: get_items ã‚’å‘¼ã³å‡ºã—
    Assert: æˆ»ã‚Šå€¤ã‚’æ¤œè¨¼
    """
    # Arrange
    mock_items = [
        Item(id=1, tenant_id='tenant-a', name='Item 1'),
        Item(id=2, tenant_id='tenant-a', name='Item 2')
    ]
    mocker.patch('repositories.items_repository.find_by_tenant', return_value=mock_items)

    # Act
    result = items_service.get_items('tenant-a')

    # Assert
    assert len(result) == 2
    assert result[0].name == 'Item 1'
```

---

## ğŸ³ Docker è¨­å®š

### Dockerfile

```dockerfile
FROM python:3.10-slim

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š
WORKDIR /app

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼
COPY src/ ./src/

# ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
ENV PYTHONUNBUFFERED=1
ENV DD_SERVICE=demo-api
ENV DD_ENV=poc

# ãƒãƒ¼ãƒˆå…¬é–‹ï¼ˆALB ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ 8000 ç•ªãƒãƒ¼ãƒˆã§ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
EXPOSE 8000

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8000/tenant-a/health || exit 1

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
CMD ["uvicorn", "src.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

---

### requirements.txt

```txt
# Web Framework
fastapi==0.109.0
uvicorn[standard]==0.27.0

# Database
sqlalchemy==2.0.25
psycopg2-binary==2.9.9

# Datadog APM
ddtrace==2.6.0

# Utilities
pydantic==2.5.0
pydantic-settings==2.1.0
python-dotenv==1.0.0

# Testing
pytest==7.4.3
pytest-asyncio==0.21.1
pytest-mock==3.12.0
pytest-cov==4.1.0
```

---

## ğŸ”§ ç’°å¢ƒå¤‰æ•°è¨­å®š

### .env.exampleï¼ˆç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰

```bash
# Databaseï¼ˆSSL/TLS å¿…é ˆï¼‰
DATABASE_URL=postgresql://user:password@localhost:5432/demo?sslmode=require

# Datadog
DD_SERVICE=demo-api
DD_ENV=poc
DD_VERSION=1.0.0
DD_AGENT_HOST=datadog-agent

# Application
VALID_TENANTS=tenant-a,tenant-b,tenant-c
LOG_LEVEL=INFO
```

**é‡è¦**: `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã«è¿½åŠ ã™ã‚‹ã“ã¨

---

## ğŸ“¦ ä¾å­˜é–¢ä¿‚ç®¡ç†

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

```bash
# é–‹ç™ºç’°å¢ƒ
pip install -r requirements.txt

# æœ¬ç•ªç’°å¢ƒ
pip install --no-cache-dir -r requirements.txt
```

---

## ğŸ“ æ§‹é€ åŒ–ãƒ­ã‚°è¨­è¨ˆ

### ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆJSONå½¢å¼ï¼‰

**æ–¹é‡**: Datadog ãƒ­ã‚°åé›†ã«æœ€é©åŒ–ã•ã‚ŒãŸ JSON å½¢å¼ã§å‡ºåŠ›

#### æ¨™æº–ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```json
{
  "timestamp": "2025-12-28T10:00:00.123Z",
  "level": "INFO",
  "message": "Request processed successfully",
  "tenant_id": "tenant-a",
  "trace_id": "abc123",
  "service": "demo-api",
  "env": "poc"
}
```

#### ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```json
{
  "timestamp": "2025-12-28T10:00:00.123Z",
  "level": "ERROR",
  "status": "error",
  "tenant": "tenant-a",
  "message": "Database connection failed",
  "trace_id": "abc123",
  "service": "demo-api",
  "env": "poc",
  "error_type": "DatabaseConnectionError",
  "stack_trace": "..."
}
```

**é‡è¦**: Infra ç›£è¦–è¨­è¨ˆï¼ˆ`.claude/docs/10_facilitation/2.3_è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚º/2.3.14_ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆ.md`ï¼‰ã¨æ•´åˆ

### ãƒ­ã‚°å‡ºåŠ›æ™‚ã®æ³¨æ„äº‹é …

#### âœ… Good Exampleï¼ˆæ§‹é€ åŒ–ãƒ­ã‚°ï¼‰

```python
# infrastructure/logger.py ã§ã®å®Ÿè£…ä¾‹
import logging
import json
from datetime import datetime

class StructuredFormatter(logging.Formatter):
    """
    JSONå½¢å¼ã®ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼
    """
    def format(self, record):
        log_data = {
            "timestamp": datetime.utcnow().isoformat(),
            "level": record.levelname,
            "message": record.getMessage(),
            "service": "demo-api",
            "env": "poc",
        }

        # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        if hasattr(record, 'tenant_id'):
            log_data['tenant_id'] = record.tenant_id
        if hasattr(record, 'trace_id'):
            log_data['trace_id'] = record.trace_id

        # ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®å ´åˆ
        if record.levelname == 'ERROR':
            log_data['status'] = 'error'
            if hasattr(record, 'tenant_id'):
                log_data['tenant'] = record.tenant_id

        return json.dumps(log_data)
```

#### âŒ Bad Exampleï¼ˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæƒ…å ±ã®éœ²å‡ºï¼‰

```python
# âŒ ç¦æ­¢: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€API Key ã‚’ãƒ­ã‚°ã«å‡ºåŠ›
logger.info(f"Database connected with password: {password}")
logger.info(f"API Key: {api_key}")
```

---

## ğŸš€ å®Ÿè£…é–‹å§‹æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Coder ãŒå®Ÿè£…é–‹å§‹å‰ã«ç¢ºèªã™ã‚‹ã“ã¨

- [ ] ã“ã®å®Ÿè£…æ–¹é‡ã‚’èª­ã‚“ã 
- [ ] æŠ€è¡“æ¨™æº–ï¼ˆ`.claude/docs/40_standards/41_app/languages/python.md`ï¼‰ã‚’èª­ã‚“ã 
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæº–ï¼ˆ`.claude/docs/40_standards/49_common/security.md`ï¼‰ã‚’èª­ã‚“ã 
- [ ] ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’ç†è§£ã—ãŸ
- [ ] å‘½åè¦å‰‡ã‚’ç†è§£ã—ãŸ
- [ ] å‹ãƒ’ãƒ³ãƒˆãŒå¿…é ˆã§ã‚ã‚‹ã“ã¨ã‚’ç†è§£ã—ãŸ
- [ ] Docstring ãŒå¿…é ˆã§ã‚ã‚‹ã“ã¨ã‚’ç†è§£ã—ãŸ
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ 80% ä»¥ä¸ŠãŒå¿…è¦ã§ã‚ã‚‹ã“ã¨ã‚’ç†è§£ã—ãŸ
- [ ] æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆJSONå½¢å¼ï¼‰ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ã‚’ç†è§£ã—ãŸ
- [ ] RDS æ¥ç¶šæ™‚ã« SSL/TLSï¼ˆ`sslmode=require`ï¼‰ãŒå¿…é ˆã§ã‚ã‚‹ã“ã¨ã‚’ç†è§£ã—ãŸ

---

## ğŸ“š å®Ÿè£…æ™‚ã®å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### å¿…é ˆå‚ç…§

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ãƒ‘ã‚¹ | ç›®çš„ |
|-------------|------|------|
| PythonæŠ€è¡“æ¨™æº– | `.claude/docs/40_standards/41_app/languages/python.md` | ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæº– | `.claude/docs/40_standards/49_common/security.md` | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­– |
| ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦ | `./01_ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦.md` | å…¨ä½“æ§‹æˆç†è§£ |
| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ | `./02_ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ.md` | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ |
| ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ | `./03_ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«.md` | ERå›³ã€SQLAlchemy Model |
| APIè¨­è¨ˆ | `./04_APIè¨­è¨ˆ.md` | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè©³ç´° |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ | `./05_ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ.md` | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ |

---

## ğŸ¯ å®Ÿè£…ã®å„ªå…ˆé †ä½

### Phase 1: åŸºç›¤å®Ÿè£…

1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä½œæˆ
2. `main.py`ï¼ˆFastAPIåˆæœŸåŒ–ï¼‰
3. `database.py`ï¼ˆDBæ¥ç¶šï¼‰
4. `item.py`ï¼ˆSQLAlchemy Modelï¼‰
5. `settings.py`ï¼ˆç’°å¢ƒå¤‰æ•°ç®¡ç†ï¼‰

---

### Phase 2: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤

1. `items_repository.py`ï¼ˆCRUDæ“ä½œï¼‰
2. `database.py`ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼‰

---

### Phase 3: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤

1. `tenant_service.py`ï¼ˆãƒ†ãƒŠãƒ³ãƒˆæ¤œè¨¼ï¼‰
2. `items_service.py`ï¼ˆã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ“ä½œï¼‰
3. `monitoring_service.py`ï¼ˆç›£è¦–ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼‰

---

### Phase 4: ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤

1. `routes.py`ï¼ˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®šç¾©ï¼‰
2. `health_controller.py`ï¼ˆãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰
3. `items_controller.py`ï¼ˆã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿CRUDï¼‰
4. `simulate_controller.py`ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
5. `admin_controller.py`ï¼ˆã‚¿ã‚¹ã‚¯åœæ­¢ï¼‰

---

### Phase 5: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤

1. `datadog_middleware.py`ï¼ˆDatadog APMçµ±åˆï¼‰
2. `error_handler.py`ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼‰
3. `logger.py`ï¼ˆæ§‹é€ åŒ–ãƒ­ã‚°ï¼‰

---

### Phase 6: ãƒ†ã‚¹ãƒˆ

1. å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆå„ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰
2. çµåˆãƒ†ã‚¹ãƒˆï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼é–“é€£æºï¼‰
3. E2Eãƒ†ã‚¹ãƒˆï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå…¨ä½“ï¼‰

---

## ğŸ” å®Ÿè£…æ™‚ã®æ³¨æ„äº‹é …

### é‡è¦ãªå®Ÿè£…åŸå‰‡

1. **è¨­è¨ˆæ›¸ã«å¾“ã†**: ç‹¬è‡ªåˆ¤æ–­ã§è¨­è¨ˆã‚’å¤‰æ›´ã—ãªã„
2. **æŠ€è¡“æ¨™æº–ã«æº–æ‹ **: Pythonè¦ç´„ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæº–ã‚’éµå®ˆ
3. **å‹ãƒ’ãƒ³ãƒˆå¿…é ˆ**: ã™ã¹ã¦ã®é–¢æ•°ã«å‹ãƒ’ãƒ³ãƒˆã‚’ä»˜ä¸
4. **Docstringå¿…é ˆ**: ã™ã¹ã¦ã®é–¢æ•°ã«æ—¥æœ¬èªDocstringã‚’è¨˜è¼‰
5. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ 80%ä»¥ä¸Š**: å®Ÿè£…ã¨åŒæ™‚ã«ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ
6. **SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–**: å¿…ãšãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨
7. **ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢**: ã™ã¹ã¦ã®ã‚¯ã‚¨ãƒªã« `tenant_id` ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨
8. **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†**: ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ç¦æ­¢
9. **RDS SSL/TLSæ¥ç¶š**: æ¥ç¶šæ–‡å­—åˆ—ã« `sslmode=require` ã‚’å¿…ãšæŒ‡å®š
10. **æ§‹é€ åŒ–ãƒ­ã‚°**: JSONå½¢å¼ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ï¼ˆDatadog ãƒ­ã‚°åé›†æœ€é©åŒ–ï¼‰

---

## ğŸ“ æ”¹è¨‚å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ | ä½œæˆè€… |
|------|-----------|----------|--------|
| 2025-12-28 | 1.0 | åˆç‰ˆä½œæˆ | App-Architect |
| 2025-12-28 | 1.1 | Dockerfile ã« EXPOSE 8000 è¿½åŠ ã€æ§‹é€ åŒ–ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¿½è¨˜ã€RDS SSL/TLS è¨­å®šæ˜è¨˜ | App-Architect |
