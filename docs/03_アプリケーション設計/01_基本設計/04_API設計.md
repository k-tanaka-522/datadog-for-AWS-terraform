# APIè¨­è¨ˆ

## ğŸ“‹ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå | APIè¨­è¨ˆ |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | 1.1 |
| ä½œæˆæ—¥ | 2025-12-28 |
| ä½œæˆè€… | App-Architect |

---

## ğŸ¯ APIè¨­è¨ˆæ–¹é‡

### åŸºæœ¬æ–¹é‡
- **RESTful API**: ãƒªã‚½ãƒ¼ã‚¹æŒ‡å‘ã®è¨­è¨ˆ
- **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ**: ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ tenant_id ã‚’å—ã‘å–ã‚‹
- **ç›£è¦–ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ**: Datadog APM ãƒˆãƒ¬ãƒ¼ã‚¹é€ä¿¡
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

### å…±é€šä»•æ§˜
- **Base URL**: `http://<ALB-DNS>/` ï¼ˆæœ¬ç•ªç’°å¢ƒ: HTTPSï¼‰
- **Content-Type**: `application/json`
- **èªè¨¼**: PoC ã§ã¯æœªå®Ÿè£…ï¼ˆæœ¬ç•ªç§»è¡Œæ™‚ã« API Key / JWT ã‚’è¿½åŠ ï¼‰

---

## ğŸ“‹ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

| # | ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | æ¦‚è¦ | èªè¨¼ | ç›£è¦–é–¢é€£ |
|---|---------|------|------|------|----------|
| 1 | GET | /{tenant_id}/health | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ | ä¸è¦ | FR-003-1 (L3) |
| 2 | POST | /{tenant_id}/simulate/error | ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿãƒ†ã‚¹ãƒˆ | ä¸è¦ | FR-003-2 (L3) |
| 3 | POST | /{tenant_id}/simulate/latency | é…å»¶ç™ºç”Ÿãƒ†ã‚¹ãƒˆ | ä¸è¦ | FR-003-3 (L3) |
| 4 | GET | /{tenant_id}/items | ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ä¸€è¦§ | ä¸è¦ | FR-001 (L0 RDS) |
| 5 | POST | /{tenant_id}/items | ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ä½œæˆ | ä¸è¦ | FR-001 (L0 RDS) |
| 6 | GET | /{tenant_id}/items/{id} | ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿è©³ç´° | ä¸è¦ | FR-001 (L0 RDS) |
| 7 | POST | /admin/shutdown | ECSã‚¿ã‚¹ã‚¯åœæ­¢ãƒ†ã‚¹ãƒˆ | ä¸è¦ | FR-002-2 (L2) |

---

## ğŸ” ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè©³ç´°

---

### 1. GET /{tenant_id}/health

**æ¦‚è¦**: ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | èª¬æ˜ |
|----------|-----|------|------|
| tenant_id | string | âœ… | ãƒ†ãƒŠãƒ³ãƒˆIDï¼ˆtenant-a, tenant-b, tenant-cï¼‰ |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹**:
```bash
GET /tenant-a/health
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ: 200 OKï¼‰**:
```json
{
  "status": "healthy",
  "tenant_id": "tenant-a",
  "database": "connected",
  "timestamp": "2025-12-28T10:00:00Z"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼: 400 Bad Request - ç„¡åŠ¹ãªãƒ†ãƒŠãƒ³ãƒˆï¼‰**:
```json
{
  "error": {
    "code": "INVALID_TENANT",
    "message": "Tenant 'tenant-x' is not valid",
    "field": "tenant_id"
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼: 503 Service Unavailable - DBæ¥ç¶šå¤±æ•—ï¼‰**:
```json
{
  "status": "unhealthy",
  "tenant_id": "tenant-a",
  "database": "disconnected",
  "timestamp": "2025-12-28T10:00:00Z"
}
```

**ç›£è¦–**: FR-003-1ï¼ˆL3 ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç›£è¦–ï¼‰
- Datadog Monitor: `/{tenant_id}/health` ãŒ200ä»¥å¤–ã‚’è¿”ã—ãŸå ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ

---

### 2. POST /{tenant_id}/simulate/error

**æ¦‚è¦**: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿãƒ†ã‚¹ãƒˆï¼ˆL3 ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç›£è¦–ç”¨ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | èª¬æ˜ |
|----------|-----|------|------|
| tenant_id | string | âœ… | ãƒ†ãƒŠãƒ³ãƒˆID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "error_type": "500"
}
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ | é¸æŠè‚¢ |
|----------|-----|------|------|--------|
| error_type | string | âœ… | ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | "500", "timeout", "db_error" |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹**:
```bash
POST /tenant-a/simulate/error
Content-Type: application/json

{
  "error_type": "500"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ: 500 Internal Server Errorï¼‰**:
```json
{
  "error": {
    "code": "SIMULATED_ERROR",
    "message": "Simulated error of type '500'",
    "tenant_id": "tenant-a",
    "timestamp": "2025-12-28T10:00:00Z"
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼: 400 Bad Request - ç„¡åŠ¹ãªã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ï¼‰**:
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid error_type. Must be one of: 500, timeout, db_error",
    "field": "error_type"
  }
}
```

**ç›£è¦–**: FR-003-2ï¼ˆL3 ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç›£è¦–ï¼‰
- Datadog Monitor: ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒ5åˆ†é–“ã§é–¾å€¤ã‚’è¶…ãˆãŸå ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ

---

### 3. POST /{tenant_id}/simulate/latency

**æ¦‚è¦**: é…å»¶ç™ºç”Ÿãƒ†ã‚¹ãƒˆï¼ˆL3 ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ç›£è¦–ç”¨ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | èª¬æ˜ |
|----------|-----|------|------|
| tenant_id | string | âœ… | ãƒ†ãƒŠãƒ³ãƒˆID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "latency_ms": 2000
}
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ | ç¯„å›² |
|----------|-----|------|------|------|
| latency_ms | integer | âœ… | é…å»¶æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰ | 0ã€œ10000 |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹**:
```bash
POST /tenant-a/simulate/latency
Content-Type: application/json

{
  "latency_ms": 2000
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ: 200 OKï¼‰**:
```json
{
  "status": "success",
  "tenant_id": "tenant-a",
  "latency_ms": 2000,
  "message": "Simulated latency of 2000ms",
  "timestamp": "2025-12-28T10:00:02Z"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼: 400 Bad Request - ç„¡åŠ¹ãªé…å»¶æ™‚é–“ï¼‰**:
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "latency_ms must be between 0 and 10000",
    "field": "latency_ms"
  }
}
```

**ç›£è¦–**: FR-003-3ï¼ˆL3 ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ç›£è¦–ï¼‰
- Datadog Monitor: ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼ˆp99ï¼‰ãŒé–¾å€¤ã‚’è¶…ãˆãŸå ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ

---

### 4. GET /{tenant_id}/items

**æ¦‚è¦**: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ä¸€è¦§å–å¾—ï¼ˆRDSç›£è¦–ç”¨ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | èª¬æ˜ |
|----------|-----|------|------|
| tenant_id | string | âœ… | ãƒ†ãƒŠãƒ³ãƒˆID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹**:
```bash
GET /tenant-a/items
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ: 200 OKï¼‰**:
```json
{
  "items": [
    {
      "id": 1,
      "tenant_id": "tenant-a",
      "name": "Sample Item 1",
      "description": "This is a sample item for tenant-a",
      "created_at": "2025-12-28T10:00:00Z",
      "updated_at": "2025-12-28T10:00:00Z"
    },
    {
      "id": 2,
      "tenant_id": "tenant-a",
      "name": "Sample Item 2",
      "description": "This is another sample item for tenant-a",
      "created_at": "2025-12-28T10:05:00Z",
      "updated_at": "2025-12-28T10:05:00Z"
    }
  ],
  "count": 2
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ: 200 OK - ãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰**:
```json
{
  "items": [],
  "count": 0
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼: 400 Bad Request - ç„¡åŠ¹ãªãƒ†ãƒŠãƒ³ãƒˆï¼‰**:
```json
{
  "error": {
    "code": "INVALID_TENANT",
    "message": "Tenant 'tenant-x' is not valid",
    "field": "tenant_id"
  }
}
```

**ç›£è¦–**: FR-001ï¼ˆL0 RDSç›£è¦–ï¼‰
- Datadog Monitor: RDS CPUä½¿ç”¨ç‡ã€æ¥ç¶šæ•°ã€ãƒ¡ãƒ¢ãƒªã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

---

### 5. POST /{tenant_id}/items

**æ¦‚è¦**: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ä½œæˆï¼ˆRDSç›£è¦–ç”¨ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | èª¬æ˜ |
|----------|-----|------|------|
| tenant_id | string | âœ… | ãƒ†ãƒŠãƒ³ãƒˆID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "name": "New Sample Item",
  "description": "This is a new sample item"
}
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ | åˆ¶ç´„ |
|----------|-----|------|------|------|
| name | string | âœ… | ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å | 1ã€œ100æ–‡å­— |
| description | string | âŒ | ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª¬æ˜ | 0ã€œ500æ–‡å­— |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹**:
```bash
POST /tenant-a/items
Content-Type: application/json

{
  "name": "New Sample Item",
  "description": "This is a new sample item"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ: 201 Createdï¼‰**:
```json
{
  "id": 3,
  "tenant_id": "tenant-a",
  "name": "New Sample Item",
  "description": "This is a new sample item",
  "created_at": "2025-12-28T10:10:00Z",
  "updated_at": "2025-12-28T10:10:00Z"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼: 400 Bad Request - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼‰**:
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "name must be between 1 and 100 characters",
    "field": "name"
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼: 500 Internal Server Error - DBæ¥ç¶šå¤±æ•—ï¼‰**:
```json
{
  "error": {
    "code": "DATABASE_ERROR",
    "message": "Failed to create item due to database error"
  }
}
```

**ç›£è¦–**: FR-001ï¼ˆL0 RDSç›£è¦–ï¼‰

---

### 6. GET /{tenant_id}/items/{id}

**æ¦‚è¦**: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿è©³ç´°å–å¾—ï¼ˆRDSç›£è¦–ç”¨ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | èª¬æ˜ |
|----------|-----|------|------|
| tenant_id | string | âœ… | ãƒ†ãƒŠãƒ³ãƒˆID |
| id | integer | âœ… | ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹**:
```bash
GET /tenant-a/items/1
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ: 200 OKï¼‰**:
```json
{
  "id": 1,
  "tenant_id": "tenant-a",
  "name": "Sample Item 1",
  "description": "This is a sample item for tenant-a",
  "created_at": "2025-12-28T10:00:00Z",
  "updated_at": "2025-12-28T10:00:00Z"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼: 404 Not Found - ãƒ‡ãƒ¼ã‚¿æœªå­˜åœ¨ï¼‰**:
```json
{
  "error": {
    "code": "ITEM_NOT_FOUND",
    "message": "Item with id 999 not found for tenant 'tenant-a'",
    "field": "id"
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼: 400 Bad Request - ç„¡åŠ¹ãªãƒ†ãƒŠãƒ³ãƒˆï¼‰**:
```json
{
  "error": {
    "code": "INVALID_TENANT",
    "message": "Tenant 'tenant-x' is not valid",
    "field": "tenant_id"
  }
}
```

**ç›£è¦–**: FR-001ï¼ˆL0 RDSç›£è¦–ï¼‰

---

### 7. POST /admin/shutdown

**æ¦‚è¦**: ECSã‚¿ã‚¹ã‚¯åœæ­¢ãƒ†ã‚¹ãƒˆï¼ˆL2 ECS Task ç›£è¦–ç”¨ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: ãªã—

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**: ãªã—

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹**:
```bash
POST /admin/shutdown
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸ: 200 OKï¼‰**:
```json
{
  "status": "shutting_down",
  "message": "ECS task will be terminated",
  "timestamp": "2025-12-28T10:15:00Z"
}
```

**æ³¨æ„**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€ä¿¡å¾Œã€å³åº§ã« `os._exit(0)` ã§ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†

**ç›£è¦–**: FR-002-2ï¼ˆL2 ECS Task åœæ­¢ç›£è¦–ï¼‰
- Datadog Monitor: ECS Task ãŒç•°å¸¸åœæ­¢ã—ãŸå ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ

---

## ğŸ” ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ä»¥ä¸‹ã®å½¢å¼ã§è¿”å´ã•ã‚Œã¾ã™ã€‚

```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error message",
    "field": "field_name",
    "timestamp": "2025-12-28T10:00:00Z"
  }
}
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ |
|----------|-----|------|
| code | string | ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆå¤§æ–‡å­—ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ï¼‰ |
| message | string | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆäººé–“ãŒèª­ã‚ã‚‹å½¢å¼ï¼‰ |
| field | string | ã‚¨ãƒ©ãƒ¼å¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆä»»æ„ï¼‰ |
| timestamp | string | ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚åˆ»ï¼ˆISO 8601å½¢å¼ï¼‰ |

---

### HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ä¸€è¦§

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ | ä½¿ç”¨ç®‡æ‰€ |
|----------------|------|----------|
| 200 OK | æˆåŠŸ | GET, POSTï¼ˆshutdownä»¥å¤–ï¼‰ |
| 201 Created | ãƒªã‚½ãƒ¼ã‚¹ä½œæˆæˆåŠŸ | POST /{tenant_id}/items |
| 400 Bad Request | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã€ç„¡åŠ¹ãªãƒ†ãƒŠãƒ³ãƒˆ |
| 404 Not Found | ãƒªã‚½ãƒ¼ã‚¹æœªå­˜åœ¨ | GET /{tenant_id}/items/{id} |
| 500 Internal Server Error | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ | ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã€DBæ¥ç¶šå¤±æ•— |
| 503 Service Unavailable | ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨ä¸å¯ | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•— |

---

### ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§ã¨ãƒ“ã‚¸ãƒã‚¹å½±éŸ¿

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | èª¬æ˜ | ãƒ“ã‚¸ãƒã‚¹å½±éŸ¿ |
|-----------|---------------|------|------------|
| INVALID_TENANT | 400 | ç„¡åŠ¹ãªãƒ†ãƒŠãƒ³ãƒˆID | **ä¸­**: ãƒ†ãƒŠãƒ³ãƒˆèªè¨¼å¤±æ•—ã€‚ä¸æ­£ãªãƒ†ãƒŠãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢ã€‚ |
| VALIDATION_ERROR | 400 | ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | **ä½**: å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ä¿®æ­£ã§å¯¾å¿œå¯èƒ½ã€‚ |
| ITEM_NOT_FOUND | 404 | ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æœªå­˜åœ¨ | **ä½**: æŒ‡å®šã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ãªã„ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å†è©¦è¡Œã§å¯¾å¿œå¯èƒ½ã€‚ |
| DATABASE_ERROR | 500 | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå¤±æ•— | **é«˜**: RDSæ¥ç¶šéšœå®³ã€‚ã‚µãƒ¼ãƒ“ã‚¹å…¨ä½“ã«å½±éŸ¿ã€‚å³åº§ã«å¯¾å¿œãŒå¿…è¦ã€‚ |
| SIMULATED_ERROR | 500 | ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | **ä½**: ç›£è¦–ãƒ†ã‚¹ãƒˆç”¨ã®æ„å›³çš„ãªã‚¨ãƒ©ãƒ¼ã€‚ãƒ“ã‚¸ãƒã‚¹å½±éŸ¿ãªã—ã€‚ |

**ãƒ“ã‚¸ãƒã‚¹å½±éŸ¿ãƒ¬ãƒ™ãƒ«ã®å®šç¾©**:
- **é«˜**: ã‚µãƒ¼ãƒ“ã‚¹å…¨ä½“ã«å½±éŸ¿ã—ã€å³åº§ã«å¯¾å¿œãŒå¿…è¦
- **ä¸­**: ä¸€éƒ¨æ©Ÿèƒ½ã«å½±éŸ¿ã™ã‚‹ãŒã€ã‚µãƒ¼ãƒ“ã‚¹å…¨ä½“ã¯ç¶™ç¶šå¯èƒ½
- **ä½**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å½±éŸ¿ã¯é™å®šçš„ã€ã¾ãŸã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å¯¾å¿œå¯èƒ½

---

## ğŸ“Š Datadog APM ãƒˆãƒ¬ãƒ¼ã‚¹è¨­è¨ˆ

### ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±

ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ä»¥ä¸‹ã®ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚’ Datadog ã«é€ä¿¡ã—ã¾ã™ã€‚

| ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ± | èª¬æ˜ |
|----------|------|
| service | demo-api |
| env | poc |
| version | 1.0.0 |
| resource | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ‘ã‚¹ï¼ˆä¾‹: GET /{tenant_id}/itemsï¼‰ |
| tenant_id | ãƒ†ãƒŠãƒ³ãƒˆIDï¼ˆã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°ï¼‰ |
| http.method | HTTPãƒ¡ã‚½ãƒƒãƒ‰ |
| http.status_code | HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ |
| http.url | ãƒªã‚¯ã‚¨ã‚¹ãƒˆURL |
| duration | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ï¼ˆãƒŸãƒªç§’ï¼‰ |

---

### ãƒˆãƒ¬ãƒ¼ã‚¹ä¾‹ï¼ˆGET /{tenant_id}/itemsï¼‰

```json
{
  "service": "demo-api",
  "env": "poc",
  "version": "1.0.0",
  "resource": "GET /{tenant_id}/items",
  "tags": {
    "tenant_id": "tenant-a",
    "http.method": "GET",
    "http.status_code": 200,
    "http.url": "/tenant-a/items"
  },
  "duration": 45,
  "spans": [
    {
      "name": "http.request",
      "duration": 45
    },
    {
      "name": "items_service.get_items",
      "duration": 30
    },
    {
      "name": "postgres.query",
      "duration": 25,
      "resource": "SELECT * FROM items WHERE tenant_id = ?"
    }
  ]
}
```

---

## ğŸ“ æ”¹è¨‚å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ | ä½œæˆè€… |
|------|-----------|----------|--------|
| 2025-12-28 | 1.0 | åˆç‰ˆä½œæˆ | App-Architect |
| 2025-12-28 | 1.1 | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ“ã‚¸ãƒã‚¹å½±éŸ¿ã‚’è¿½è¨˜ | App-Architect |
