# ç›£è¦–è¨­è¨ˆï¼ˆComposite Monitorï¼‰

## 1. æ¦‚è¦

æœ¬PoCã®**æœ€é‡è¦è¨­è¨ˆ**ã§ã™ã€‚Datadog Composite Monitor ã‚’ä½¿ç”¨ã—ãŸ**4éšå±¤ç›£è¦–ï¼ˆL0/L1/L2/L3ï¼‰**ã«ã‚ˆã‚Šã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚¹ãƒˆãƒ¼ãƒ ã‚’é˜²æ­¢ã—ã€éšœå®³åŸå› ã®è¿…é€Ÿãªç‰¹å®šã‚’å®Ÿç¾ã—ã¾ã™ã€‚

### è¨­è¨ˆã®æ ¸å¿ƒ

```
L0ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰éšœå®³ â†’ L1/L2/L3ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶
L1ï¼ˆã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆï¼‰éšœå®³ â†’ L2/L3ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶
L2ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰éšœå®³ â†’ L3ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶
L3ï¼ˆãƒ†ãƒŠãƒ³ãƒˆï¼‰éšœå®³ â†’ ãƒ†ãƒŠãƒ³ãƒˆå›ºæœ‰ã®å•é¡Œã¨ã—ã¦é€šçŸ¥
```

**ç›®çš„**: é‹ç”¨ãƒãƒ¼ãƒ ãŒã€Œæ ¹æœ¬åŸå› ã€ã®ã‚¢ãƒ©ãƒ¼ãƒˆã®ã¿ã‚’å—ã‘å–ã‚Šã€æ´¾ç”Ÿã‚¢ãƒ©ãƒ¼ãƒˆã‚’ç„¡è¦–ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

## 1.5 è¨­è¨ˆæ€æƒ³

### ã‚¢ãƒ©ãƒ¼ãƒˆã‚¹ãƒˆãƒ¼ãƒ é˜²æ­¢ã®3ã¤ã®æŸ±

æœ¬è¨­è¨ˆã¯ä»¥ä¸‹ã®3ã¤ã®æŸ±ã§ã‚¢ãƒ©ãƒ¼ãƒˆã‚¹ãƒˆãƒ¼ãƒ ã‚’é˜²æ­¢ã—ã¾ã™ã€‚

| æŸ± | æ‰‹æ³• | åŠ¹æœ | å®Ÿè£…çŠ¶æ³ |
|----|------|------|---------|
| **Composite Monitor** | è¤‡åˆæ¡ä»¶ã®ãƒ–ãƒ¼ãƒ«è«–ç†çµåˆ | èª¤æ¤œçŸ¥70%å‰Šæ¸› | âœ… PoCå®Ÿè£… |
| **Webhook + Downtime API** | ä¾å­˜é–¢ä¿‚ãƒ™ãƒ¼ã‚¹ã®å‹•çš„ãƒŸãƒ¥ãƒ¼ãƒˆ | ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰éšœå®³å¯¾å¿œ | âš ï¸ å°†æ¥æ‹¡å¼µ |
| **çµ±ä¸€ã‚¿ã‚°è¨­è¨ˆ** | `layer:`, `service:`, `env:` ã«ã‚ˆã‚‹ã‚¹ã‚³ãƒ¼ãƒ—ç®¡ç† | ä¸€æ‹¬æ“ä½œå¯èƒ½ | âœ… PoCå®Ÿè£… |

### ã‚¢ãƒ©ãƒ¼ãƒˆãƒã‚¤ã‚ºå‰Šæ¸›ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

| æ–½ç­– | åŠ¹æœ | å®Ÿè£…é›£æ˜“åº¦ | PoCå¯¾å¿œ |
|------|------|-----------|--------|
| Composite Monitor | è¤‡åˆæ¡ä»¶ã§èª¤æ¤œçŸ¥70%å‰Šæ¸› | ä¸­ | âœ… |
| é€šçŸ¥ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚° | ãƒ›ã‚¹ãƒˆâ†’ã‚µãƒ¼ãƒ“ã‚¹å˜ä½ã§90%å‰Šæ¸› | ä½ | âœ… |
| è©•ä¾¡ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ‹¡å¤§ | ä¸€æ™‚ã‚¹ãƒ‘ã‚¤ã‚¯ã«ã‚ˆã‚‹èª¤æ¤œçŸ¥æ’é™¤ | ä½ | âœ… |
| Recovery Threshold | ãƒ•ãƒ©ãƒƒãƒ”ãƒ³ã‚°é˜²æ­¢ï¼ˆé–¾å€¤å·®ã‚’ã¤ã‘ã‚‹ï¼‰ | ä½ | âœ… |
| Webhookä¾å­˜é–¢ä¿‚æŠ‘åˆ¶ | ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰éšœå®³æ™‚ã®é›†ç´„ | é«˜ | âš ï¸ å°†æ¥ |
| Scheduled Downtime | è¨ˆç”»ä½œæ¥­æ™‚ã®ã‚¼ãƒ­ãƒã‚¤ã‚º | ä½ | âš ï¸ å°†æ¥ |

### æ¨å¥¨é–¾å€¤ã®æ ¹æ‹ 

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | Warning | Critical | æ ¹æ‹  |
|-----------|---------|----------|------|
| p95/p99 ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· | 500ms | 1000ms | ä¸€èˆ¬çš„ãªWeb APIã®SLA |
| ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒ¼ãƒˆ | 1% | 5% | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æãªã‚ãªã„ç›®å®‰ |
| RDS CPU | 80% | 95% | 15åˆ†ç¶™ç¶šã§ã‚¢ãƒ©ãƒ¼ãƒˆ |
| RDS æ¥ç¶šæ•° | max_connectionsã®80% | 90% | æ¯æ¸‡å‰ã«æ¤œçŸ¥ |

### Unified Service Tagging

ECS Fargateç’°å¢ƒã§APMã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ãŸã‚ã®å¿…é ˆè¨­å®šï¼š

| ç’°å¢ƒå¤‰æ•° | ç”¨é€” | ä¾‹ |
|---------|------|-----|
| `DD_SERVICE` | ã‚µãƒ¼ãƒ“ã‚¹è­˜åˆ¥ | `demo-api` |
| `DD_ENV` | ç’°å¢ƒè­˜åˆ¥ | `poc` |
| `DD_VERSION` | ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¿½è·¡ | `1.0.0` |
| `DD_APM_ENABLED` | APMãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°æœ‰åŠ¹åŒ– | `true` |
| `DD_APM_NON_LOCAL_TRAFFIC` | ä»–ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã®ãƒˆãƒ¬ãƒ¼ã‚¹å—ä¿¡ | `true` |

**å‚ç…§**: Datadogå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ - Unified Service Tagging

### ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ãƒ„ãƒ¼ãƒ«é¸æŠã®åˆ¤æ–­åŸºæº–

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ä¸»è¦ãƒ„ãƒ¼ãƒ« | è£œåŠ©ãƒ„ãƒ¼ãƒ« | ç†ç”± |
|---------|-----------|-----------|------|
| **L0 (VPC/ALB)** | AWSã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ãªã— | Agentä¸å¯ã€CloudWatchã§ååˆ† |
| **L1 (ECS)** | APM Agent | AWSã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ãƒˆãƒ¬ãƒ¼ã‚¹å¿…é ˆã€ã‚¯ãƒ©ã‚¹ã‚¿å…¨ä½“åƒã¯Integrationã§è£œå®Œ |
| **L1 (RDS)** | AWSã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ + DBM | ãªã— | RDSä¸Šã«Agentä¸å¯ã€ãƒªãƒ¢ãƒ¼ãƒˆDBMã§æ·±ã„æ´å¯Ÿ |
| **L2 (E2E)** | Synthetics Monitoring | ãªã— | å¤–éƒ¨ã‹ã‚‰ã®æ­»æ´»ç›£è¦– |
| **L3 (ãƒ†ãƒŠãƒ³ãƒˆ)** | APM + Logs | ãªã— | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®è©³ç´°ç›£è¦– |

### CloudWatch ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã®é…å»¶ç‰¹æ€§

| æ–¹å¼ | é…å»¶ | æ¨å¥¨ç”¨é€” |
|------|------|---------|
| API Pollingï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ | 15ã€œ20åˆ† | éã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ç›£è¦– |
| CloudWatch Metric Streams | 2ã€œ3åˆ† | ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ç›£è¦–ï¼ˆALB, Lambdaï¼‰ |

**æ³¨**: PoCæ®µéšã§ã¯API Pollingã‚’ä½¿ç”¨ã€‚æœ¬ç•ªç§»è¡Œæ™‚ã¯Metric Streamsã‚’æ¤œè¨ã€‚

## 2. ç›£è¦–éšå±¤ã®å®šç¾©

### ç›£è¦–éšå±¤ã®å…¨ä½“åƒ

æœ¬è¨­è¨ˆã§ã¯**L0/L1/L2/L3ã®4å±¤æ§‹æˆ**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

| å±¤ | è²¬å‹™ | ç›£è¦–å¯¾è±¡ | å½±éŸ¿ç¯„å›² |
|-----|------|---------|---------|
| **L0** | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç›¤ç›£è¦– | RDSã€VPCã€Datadog Agent | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |
| **L1** | ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆåŸºç›¤ç›£è¦– | ECS | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |
| **L2** | ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ«ç›£è¦– | ALBã€ECS Taskã€ECRã€**E2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯** | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |
| **L3** | ãƒ†ãƒŠãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ç›£è¦– | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· | è©²å½“ãƒ†ãƒŠãƒ³ãƒˆã®ã¿ |

### 2.1 L0: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç›¤ç›£è¦–

**è²¬å‹™**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç›¤ã®å¥å…¨æ€§ã‚’ç›£è¦–ã€‚L0éšœå®³ã¯L1/L2/L3ã«å½±éŸ¿ã‚’åŠã¼ã™ã€‚

| Monitor ID | ç›£è¦–å¯¾è±¡ | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | é–¾å€¤ | å½±éŸ¿ç¯„å›² |
|-----------|---------|---------|------|---------|
| L0-RDS-CPU | RDS CPUä½¿ç”¨ç‡ | `aws.rds.cpuutilization` | > 95% | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |
| L0-RDS-Conn | RDS æ¥ç¶šæ•° | `aws.rds.database_connections` | > 90% of max | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |
| L0-RDS-Mem | RDS ãƒ¡ãƒ¢ãƒª | `aws.rds.freeable_memory` | < 10% of total | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |
| L0-RDS-Storage | RDS ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | `aws.rds.free_storage_space` | < 5% of total | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |
| L0-VPC-Flow | VPC Flow Logs ç•°å¸¸ | `vpc.flow.anomaly` | ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œçŸ¥ | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |
| L0-Agent | Datadog Agent æ­»æ´» | `datadog.agent.up` | = 0 | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |

**é‡è¦**: L0éšœå®³ã¯å…¨ãƒ†ãƒŠãƒ³ãƒˆã«å½±éŸ¿ã™ã‚‹ãŸã‚ã€L0ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç«æ™‚ã¯L1/L2/L3ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶ã€‚

### 2.2 L1: ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆåŸºç›¤ç›£è¦–ï¼ˆæ–°è¦è¿½åŠ ï¼‰

**è²¬å‹™**: ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆåŸºç›¤ã®å¥å…¨æ€§ã‚’ç›£è¦–ã€‚L1éšœå®³ã¯L2/L3ã«å½±éŸ¿ã‚’åŠã¼ã™ã€‚

| Monitor ID | ç›£è¦–å¯¾è±¡ | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | é–¾å€¤ | å½±éŸ¿ç¯„å›² |
|-----------|---------|---------|------|---------|
| L1-ECS-Tasks | ECS Running Tasks | `aws.ecs.running_tasks_count` | = 0 | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |

**é‡è¦**: L1éšœå®³ã¯å…¨ãƒ†ãƒŠãƒ³ãƒˆã«å½±éŸ¿ã™ã‚‹ãŸã‚ã€L1ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç«æ™‚ã¯L2/L3ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶ã€‚

### 2.3 L2: ã‚µãƒ¼ãƒ“ã‚¹ç›£è¦–

**è²¬å‹™**: AWSã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¥å…¨æ€§ã‚’ç›£è¦–ã€‚L2éšœå®³ã¯ãƒ†ãƒŠãƒ³ãƒˆã«å½±éŸ¿ã‚’åŠã¼ã™ã€‚

| Monitor ID | ç›£è¦–å¯¾è±¡ | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | é–¾å€¤ | å½±éŸ¿ç¯„å›² |
|-----------|---------|---------|------|---------|
| L2-ALB-Health | ALB Target Group Health | `aws.applicationelb.healthy_host_count` | = 0 | å…¨ãƒ†ãƒŠãƒ³ãƒˆ |
| L2-ECS-Task | ECS Task ç•°å¸¸åœæ­¢ | `ecs.task.stopped` (Event) | ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ | è©²å½“ãƒ†ãƒŠãƒ³ãƒˆ |
| L2-ECR-Vuln | ECR è„†å¼±æ€§ | `aws.ecr.vulnerability.critical` | > 0 | è©²å½“ã‚¤ãƒ¡ãƒ¼ã‚¸ |
| **FR-002-5** | **ALBâ†’APIâ†’RDS E2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯** | **Synthetic Monitoring** | **HTTP 200ä»¥å¤–ã€ã¾ãŸã¯å¿œç­”æ™‚é–“5ç§’è¶…** | **å…¨ãƒ†ãƒŠãƒ³ãƒˆ** |

**é‡è¦**: L2éšœå®³ã¯ç‰¹å®šã®ã‚µãƒ¼ãƒ“ã‚¹ã«å½±éŸ¿ã™ã‚‹ãŸã‚ã€L2ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç«æ™‚ã¯è©²å½“ãƒ†ãƒŠãƒ³ãƒˆã®L3ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶ã€‚

#### L2-ECS-Task Monitor ã‚¯ã‚¨ãƒªè©³ç´°

**Type**: Event Monitor

**Query**:
```
events("source:ecs status:error ecs.cluster-name:myapp-cluster").rollup("count").last("5m") > 0
```

**è§£èª¬**:
- `source:ecs`: ECSã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–
- `status:error`: ã‚¨ãƒ©ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿
- `ecs.cluster-name:myapp-cluster`: å¯¾è±¡ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æŒ‡å®š
- 5åˆ†é–“ã§ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆãŒ1ä»¶ä»¥ä¸Šç™ºç”Ÿã—ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆ

**Datadog Provider ã§ã®å®Ÿè£…ä¾‹**:
```hcl
resource "datadog_monitor" "ecs_task_stopped" {
  name    = "[L2] ECS Task ç•°å¸¸åœæ­¢"
  type    = "event-v2 alert"
  query   = "events(\"source:ecs status:error ecs.cluster-name:myapp-cluster\").rollup(\"count\").last(\"5m\") > 0"
  message = <<-EOT
    [L2] ECS TaskãŒç•°å¸¸åœæ­¢ã—ã¾ã—ãŸã€‚
    - Cluster: myapp-cluster
    - å½±éŸ¿: è©²å½“ãƒ†ãƒŠãƒ³ãƒˆ
  EOT

  tags = ["layer:l2", "resource:ecs", "severity:high"]
}
```

#### FR-002-5: ALBâ†’APIâ†’RDS E2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆæ–°è¦è¿½åŠ ï¼‰

**ç›®çš„**: ALBçµŒç”±ã§ECSâ†’RDSã®ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ç–é€šã‚’ç¢ºèªã—ã€ã‚¤ãƒ³ãƒ•ãƒ©å…¨ä½“ã®å¥å…¨æ€§ã‚’ç›£è¦–ã€‚

**ç›£è¦–æ–¹å¼**: Datadog Synthetic Monitoringï¼ˆHTTP Checkï¼‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `https://{ALB_FQDN}/health`
- ãƒ†ãƒŠãƒ³ãƒˆIDãªã—ï¼ˆå…¨ä½“ç–é€šç¢ºèªï¼‰
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§å®Ÿè£…ãŒå¿…è¦

**ç¢ºèªå†…å®¹**:
1. ALB â†’ ECS Fargate ã®ç–é€š
2. ECS Fargate â†’ RDS ã®ç–é€šï¼ˆSELECT 1 ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼‰
3. HTTP 200 ãƒ¬ã‚¹ãƒãƒ³ã‚¹
4. å¿œç­”æ™‚é–“ < 5ç§’

**ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶**:
- HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ200ä»¥å¤–
- å¿œç­”æ™‚é–“ãŒ5ç§’è¶…
- 3å›é€£ç¶šå¤±æ•—ã§ã‚¢ãƒ©ãƒ¼ãƒˆ

**Datadog Provider ã§ã®å®Ÿè£…ä¾‹**:
```hcl
resource "datadog_synthetics_test" "e2e_health_check" {
  name    = "[L2] ALBâ†’APIâ†’RDS E2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯"
  type    = "api"
  subtype = "http"
  status  = "live"

  request_definition {
    method = "GET"
    url    = "https://${var.alb_fqdn}/health"
  }

  assertion {
    type     = "statusCode"
    operator = "is"
    target   = "200"
  }

  assertion {
    type     = "responseTime"
    operator = "lessThan"
    target   = "5000"  # 5ç§’
  }

  locations = ["aws:ap-northeast-1"]

  options_list {
    tick_every = 300  # 5åˆ†ã”ã¨
    retry {
      count    = 2
      interval = 300
    }
  }

  message = <<-EOT
    [L2] ALBâ†’APIâ†’RDS E2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚
    - URL: https://${var.alb_fqdn}/health
    - å½±éŸ¿: å…¨ãƒ†ãƒŠãƒ³ãƒˆï¼ˆã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ã®å¯èƒ½æ€§ï¼‰
    - ç¢ºèªå†…å®¹: ALB â†’ ECS â†’ RDS ç–é€š
  EOT

  tags = ["layer:l2", "resource:e2e", "severity:critical"]
}
```

**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®å®Ÿè£…è¦ä»¶**:
- `/health` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…
- RDSã¸ã®ç–é€šç¢ºèªï¼ˆ`SELECT 1` ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:
  ```json
  {
    "status": "ok",
    "database": "connected",
    "timestamp": "2025-12-28T12:34:56.789Z"
  }
  ```

**å‚ç…§**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆæ›¸ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰ã¨æ•´åˆã•ã›ã¦ãã ã•ã„ã€‚

### 2.4 L3: ãƒ†ãƒŠãƒ³ãƒˆç›£è¦–

**è²¬å‹™**: ãƒ†ãƒŠãƒ³ãƒˆå›ºæœ‰ã®å•é¡Œã‚’ç›£è¦–ã€‚L3éšœå®³ã¯ãƒ†ãƒŠãƒ³ãƒˆå›ºæœ‰ã®å•é¡Œã€‚

| Monitor IDï¼ˆä¾‹: tenant-aï¼‰ | ç›£è¦–å¯¾è±¡ | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | é–¾å€¤ | å½±éŸ¿ç¯„å›² |
|---------------------------|---------|---------|------|---------|
| FR-003-1 | **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆRDSç–é€šå«ã‚€ï¼‰** | `http.check{tenant:tenant-a}` | != 200 | tenant-a ã®ã¿ |
| L3-Error-tenant-a | ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°æ•° | `log.error{tenant:tenant-a}` | > 10/5åˆ† | tenant-a ã®ã¿ |
| L3-Latency-tenant-a | ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼ˆp99ï¼‰ | `trace.web.request.duration.p99{tenant:tenant-a}` | > 1ç§’ | tenant-a ã®ã¿ |

**é‡è¦**: L3éšœå®³ã¯ãƒ†ãƒŠãƒ³ãƒˆå›ºæœ‰ã®å•é¡Œï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚°ã€ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ç­‰ï¼‰ã¨ã—ã¦é€šçŸ¥ã€‚

#### FR-003-1: ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆRDSç–é€šå«ã‚€ã€å¼·åŒ–ï¼‰

**ç›®çš„**: ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ALB â†’ ECS â†’ RDS ã®ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ç–é€šã‚’ç¢ºèªã€‚

**ç›£è¦–æ–¹å¼**: Datadog Synthetic Monitoringï¼ˆHTTP Checkï¼‰ã¾ãŸã¯ Service Check Monitor

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `https://{ALB_FQDN}/{tenant_id}/health`
- ãƒ†ãƒŠãƒ³ãƒˆIDã‚’å«ã‚€ï¼ˆãƒ†ãƒŠãƒ³ãƒˆåˆ¥ç–é€šç¢ºèªï¼‰
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§å®Ÿè£…ãŒå¿…è¦

**ç¢ºèªå†…å®¹**:
1. ALB â†’ ECS Fargate ã®ç–é€š
2. **ECS Fargate â†’ RDS ã®ç–é€šï¼ˆ`SELECT 1 FROM {tenant_table} WHERE tenant_id = '{tenant_id}' LIMIT 1` ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼‰**
3. HTTP 200 ãƒ¬ã‚¹ãƒãƒ³ã‚¹
4. å¿œç­”æ™‚é–“ < 5ç§’

**L2ï¼ˆFR-002-5ï¼‰ã¨ã®é•ã„**:
| é …ç›® | L2ï¼ˆFR-002-5ï¼‰ | L3ï¼ˆFR-003-1ï¼‰ |
|------|---------------|---------------|
| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | `/health` | `/{tenant_id}/health` |
| ãƒ†ãƒŠãƒ³ãƒˆè­˜åˆ¥ | ãªã— | ã‚ã‚Š |
| RDSã‚¯ã‚¨ãƒª | `SELECT 1` | `SELECT 1 FROM {tenant_table} WHERE tenant_id = '{tenant_id}' LIMIT 1` |
| å½±éŸ¿ç¯„å›² | å…¨ãƒ†ãƒŠãƒ³ãƒˆ | è©²å½“ãƒ†ãƒŠãƒ³ãƒˆã®ã¿ |
| ã‚¢ãƒ©ãƒ¼ãƒˆæŠ‘åˆ¶ | L0/L1éšœå®³æ™‚ã«æŠ‘åˆ¶ | L0/L1/L2éšœå®³æ™‚ã«æŠ‘åˆ¶ |

**ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶**:
- HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ200ä»¥å¤–
- å¿œç­”æ™‚é–“ãŒ5ç§’è¶…
- 2å›é€£ç¶šå¤±æ•—ã§ã‚¢ãƒ©ãƒ¼ãƒˆ

**Datadog Provider ã§ã®å®Ÿè£…ä¾‹ï¼ˆSynthetics Testæ¨å¥¨ï¼‰**:
```hcl
resource "datadog_synthetics_test" "tenant_health_check" {
  name    = "[L3] ${var.tenant_id} ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆRDSç–é€šå«ã‚€ï¼‰"
  type    = "api"
  subtype = "http"
  status  = "live"

  request_definition {
    method = "GET"
    url    = "https://${var.alb_fqdn}/${var.tenant_id}/health"
  }

  assertion {
    type     = "statusCode"
    operator = "is"
    target   = "200"
  }

  assertion {
    type     = "responseTime"
    operator = "lessThan"
    target   = "5000"  # 5ç§’
  }

  assertion {
    type     = "body"
    operator = "contains"
    target   = "\"status\":\"ok\""
  }

  locations = ["aws:ap-northeast-1"]

  options_list {
    tick_every = 300  # 5åˆ†ã”ã¨
    retry {
      count    = 1
      interval = 300
    }
  }

  message = <<-EOT
    [L3] ${var.tenant_id} ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆRDSç–é€šå«ã‚€ï¼‰ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚
    - URL: https://${var.alb_fqdn}/${var.tenant_id}/health
    - å½±éŸ¿: ${var.tenant_id} ã®ã¿
    - ç¢ºèªå†…å®¹: ALB â†’ ECS â†’ RDSï¼ˆtenant_id='${var.tenant_id}'ï¼‰ç–é€š
  EOT

  tags = ["layer:l3", "tenant:${var.tenant_id}", "severity:high"]
}
```

**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®å®Ÿè£…è¦ä»¶**:
- `/{tenant_id}/health` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…
- RDSã¸ã®ç–é€šç¢ºèªï¼ˆãƒ†ãƒŠãƒ³ãƒˆIDã§ãƒ•ã‚£ãƒ«ã‚¿ã—ãŸã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:
  ```json
  {
    "status": "ok",
    "tenant_id": "tenant-a",
    "database": "connected",
    "query": "SELECT 1 FROM tenants WHERE tenant_id = 'tenant-a' LIMIT 1",
    "timestamp": "2025-12-28T12:34:56.789Z"
  }
  ```

**å‚ç…§**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆæ›¸ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰ã¨æ•´åˆã•ã›ã¦ãã ã•ã„ã€‚

## 3. Composite Monitor ã®è¨­è¨ˆ

### 3.1 Composite Monitor ã®æ§‹é€ 

```mermaid
graph TB
    subgraph "Composite Monitor: L0-Network"
        L0_Composite[L0-Composite<br/>ORæ¼”ç®—]
        L0_RDS[L0-RDS-CPU]
        L0_Conn[L0-RDS-Conn]
        L0_Mem[L0-RDS-Mem]
        L0_Storage[L0-RDS-Storage]
        L0_VPC[L0-VPC-Flow]
        L0_Agent[L0-Agent]

        L0_RDS --> L0_Composite
        L0_Conn --> L0_Composite
        L0_Mem --> L0_Composite
        L0_Storage --> L0_Composite
        L0_VPC --> L0_Composite
        L0_Agent --> L0_Composite
    end

    subgraph "Composite Monitor: L1-Compute"
        L1_Composite[L1-Composite<br/>ORæ¼”ç®—]
        L1_ECS[L1-ECS-Tasks]

        L1_ECS --> L1_Composite
    end

    subgraph "Composite Monitor: L2-Service"
        L2_Composite[L2-Composite<br/>ORæ¼”ç®—]
        L2_ALB[L2-ALB-Health]
        L2_Task[L2-ECS-Task]
        L2_ECR[L2-ECR-Vuln]
        L2_E2E[FR-002-5: E2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯]

        L2_ALB --> L2_Composite
        L2_Task --> L2_Composite
        L2_ECR --> L2_Composite
        L2_E2E --> L2_Composite
    end

    subgraph "Composite Monitor: L3-Tenantï¼ˆtenant-aï¼‰"
        L3_Composite_A[L3-Composite-tenant-a<br/>ORæ¼”ç®—]
        L3_Health_A[FR-003-1: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯<br/>RDSç–é€šå«ã‚€]
        L3_Error_A[L3-Error-tenant-a]
        L3_Latency_A[L3-Latency-tenant-a]

        L3_Health_A --> L3_Composite_A
        L3_Error_A --> L3_Composite_A
        L3_Latency_A --> L3_Composite_A
    end

    %% ã‚¢ãƒ©ãƒ¼ãƒˆæŠ‘åˆ¶ã®è¦ªå­é–¢ä¿‚
    L0_Composite -.->|L0 ALERTæ™‚ã€L1/L2/L3æŠ‘åˆ¶| L1_Composite
    L0_Composite -.->|L0 ALERTæ™‚ã€L2/L3æŠ‘åˆ¶| L2_Composite
    L0_Composite -.->|L0 ALERTæ™‚ã€L3æŠ‘åˆ¶| L3_Composite_A
    L1_Composite -.->|L1 ALERTæ™‚ã€L2/L3æŠ‘åˆ¶| L2_Composite
    L1_Composite -.->|L1 ALERTæ™‚ã€L3æŠ‘åˆ¶| L3_Composite_A
    L2_Composite -.->|L2 ALERTæ™‚ã€L3æŠ‘åˆ¶| L3_Composite_A

    style L0_Composite fill:#ff9999
    style L1_Composite fill:#ffcc99
    style L2_Composite fill:#ffff99
    style L3_Composite_A fill:#99ccff
```

### 3.2 Composite Monitor ã®è«–ç†å¼

#### L0-Compositeï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç›¤ Compositeï¼‰

```
L0-Composite =
  L0-RDS-CPU OR
  L0-RDS-Conn OR
  L0-RDS-Mem OR
  L0-RDS-Storage OR
  L0-VPC-Flow OR
  L0-Agent
```

**æ„å‘³**: ã„ãšã‚Œã‹ã®L0 Monitor ãŒALERTçŠ¶æ…‹ã«ãªã‚Œã°ã€L0-Composite ãŒALERTã€‚

#### L1-Compositeï¼ˆã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆåŸºç›¤ Compositeï¼‰

```
L1-Composite =
  L1-ECS-Tasks
  AND NOT L0-Composite
```

**æ„å‘³**: L1-ECS-Tasks ãŒALERTã€ã‹ã¤L0-CompositeãŒALERTã§ãªã„å ´åˆã®ã¿ã€L1-Composite ãŒALERTã€‚

**é‡è¦**: `AND NOT L0-Composite` ã«ã‚ˆã‚Šã€L0éšœå®³ä¸­ã¯L1ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶ã€‚

#### L2-Compositeï¼ˆã‚µãƒ¼ãƒ“ã‚¹ Compositeï¼‰

```
L2-Composite =
  (L2-ALB-Health OR L2-ECS-Task OR L2-ECR-Vuln OR FR-002-5)
  AND NOT L0-Composite
  AND NOT L1-Composite
```

**æ„å‘³**: ã„ãšã‚Œã‹ã®L2 Monitor ãŒALERTã€ã‹ã¤L0/L1-CompositeãŒALERTã§ãªã„å ´åˆã®ã¿ã€L2-Composite ãŒALERTã€‚

**é‡è¦**: `AND NOT L0-Composite AND NOT L1-Composite` ã«ã‚ˆã‚Šã€L0/L1éšœå®³ä¸­ã¯L2ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶ã€‚

#### L3-Compositeï¼ˆãƒ†ãƒŠãƒ³ãƒˆ Compositeã€ä¾‹: tenant-aï¼‰

```
L3-Composite-tenant-a =
  (FR-003-1 OR L3-Error-tenant-a OR L3-Latency-tenant-a)
  AND NOT L0-Composite
  AND NOT L1-Composite
  AND NOT L2-Composite
```

**æ„å‘³**: ã„ãšã‚Œã‹ã®L3 Monitor ãŒALERTã€ã‹ã¤L0/L1/L2-CompositeãŒALERTã§ãªã„å ´åˆã®ã¿ã€L3-Composite ãŒALERTã€‚

**é‡è¦**: `AND NOT L0-Composite AND NOT L1-Composite AND NOT L2-Composite` ã«ã‚ˆã‚Šã€L0/L1/L2éšœå®³ä¸­ã¯L3ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶ã€‚

## 4. ã‚¢ãƒ©ãƒ¼ãƒˆæŠ‘åˆ¶ã®ã‚·ãƒŠãƒªã‚ª

### ã‚·ãƒŠãƒªã‚ª1: L0éšœå®³ï¼ˆRDS CPUé«˜é¨°ï¼‰

```
[ç™ºç”Ÿ]
1. RDS CPUä½¿ç”¨ç‡ãŒ95%ã‚’è¶…ãˆã‚‹ â†’ L0-RDS-CPU ãŒ ALERT
2. L0-Composite ãŒ ALERTï¼ˆL0-RDS-CPU ãŒãƒˆãƒªã‚¬ãƒ¼ï¼‰
3. æ´¾ç”Ÿçš„ã«ã€ECS TaskãŒå…¨åœæ­¢ â†’ L1-ECS-Tasks ãŒ ALERT
4. æ´¾ç”Ÿçš„ã«ã€FR-002-5ï¼ˆE2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰ãŒå¤±æ•— â†’ FR-002-5 ãŒ ALERT
5. æ´¾ç”Ÿçš„ã«ã€tenant-a ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒå¢—åŠ  â†’ L3-Error-tenant-a ãŒ ALERT

[Composite Monitor ã®åˆ¤å®š]
- L0-Composite: ALERTï¼ˆé€šçŸ¥ã™ã‚‹ï¼‰
- L1-Composite: (L1-ECS-Tasks = ALERT) AND NOT L0-Composite â†’ FALSEï¼ˆé€šçŸ¥ã—ãªã„ï¼‰
- L2-Composite: (FR-002-5 = ALERT) AND NOT L0-Composite AND NOT L1-Composite â†’ FALSEï¼ˆé€šçŸ¥ã—ãªã„ï¼‰
- L3-Composite-tenant-a: (L3-Error-tenant-a = ALERT) AND NOT L0-Composite AND NOT L1-Composite AND NOT L2-Composite â†’ FALSEï¼ˆé€šçŸ¥ã—ãªã„ï¼‰

[é‹ç”¨ãƒãƒ¼ãƒ ã¸ã®é€šçŸ¥]
- L0-Composite ã®ã‚¢ãƒ©ãƒ¼ãƒˆã®ã¿é€šçŸ¥
- é‹ç”¨ãƒãƒ¼ãƒ ã¯ã€ŒRDS CPUé«˜é¨°ã€ã‚’èªè­˜ã—ã€RDSã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ã‚’å®Ÿæ–½
```

**çµæœ**: ã‚¢ãƒ©ãƒ¼ãƒˆåœ°ç„ã‚’å›é¿ã€‚é‹ç”¨ãƒãƒ¼ãƒ ã¯æ ¹æœ¬åŸå› ï¼ˆRDSï¼‰ã®ã¿ã«é›†ä¸­ã€‚

### ã‚·ãƒŠãƒªã‚ª2: L1éšœå®³ï¼ˆECS Taskså…¨åœæ­¢ï¼‰

```
[ç™ºç”Ÿ]
1. ECS TasksãŒå…¨åœæ­¢ â†’ L1-ECS-Tasks ãŒ ALERT
2. L1-Composite ãŒ ALERTï¼ˆL1-ECS-Tasks ãŒãƒˆãƒªã‚¬ãƒ¼ï¼‰
3. æ´¾ç”Ÿçš„ã«ã€FR-002-5ï¼ˆE2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰ãŒå¤±æ•— â†’ FR-002-5 ãŒ ALERT
4. æ´¾ç”Ÿçš„ã«ã€tenant-a ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•— â†’ FR-003-1 ãŒ ALERT

[Composite Monitor ã®åˆ¤å®š]
- L0-Composite: OKï¼ˆL0ã¯æ­£å¸¸ï¼‰
- L1-Composite: (L1-ECS-Tasks = ALERT) AND NOT L0-Composite â†’ TRUEï¼ˆé€šçŸ¥ã™ã‚‹ï¼‰
- L2-Composite: (FR-002-5 = ALERT) AND NOT L0-Composite AND NOT L1-Composite â†’ FALSEï¼ˆé€šçŸ¥ã—ãªã„ï¼‰
- L3-Composite-tenant-a: (FR-003-1 = ALERT) AND NOT L0-Composite AND NOT L1-Composite AND NOT L2-Composite â†’ FALSEï¼ˆé€šçŸ¥ã—ãªã„ï¼‰

[é‹ç”¨ãƒãƒ¼ãƒ ã¸ã®é€šçŸ¥]
- L1-Composite ã®ã‚¢ãƒ©ãƒ¼ãƒˆã®ã¿é€šçŸ¥
- é‹ç”¨ãƒãƒ¼ãƒ ã¯ã€ŒECS Tasksåœæ­¢ã€ã‚’èªè­˜ã—ã€ECS Serviceã‚’å†èµ·å‹•
```

**çµæœ**: L2/L3ã‚¢ãƒ©ãƒ¼ãƒˆã¯æŠ‘åˆ¶ã•ã‚Œã€é‹ç”¨ãƒãƒ¼ãƒ ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆå±¤ã®å•é¡Œã«é›†ä¸­ã€‚

### ã‚·ãƒŠãƒªã‚ª3: L2éšœå®³ï¼ˆE2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—ï¼‰

```
[ç™ºç”Ÿ]
1. ALBâ†’APIâ†’RDS ã®E2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•— â†’ FR-002-5 ãŒ ALERT
2. L2-Composite ãŒ ALERTï¼ˆFR-002-5 ãŒãƒˆãƒªã‚¬ãƒ¼ï¼‰
3. æ´¾ç”Ÿçš„ã«ã€tenant-a ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•— â†’ FR-003-1 ãŒ ALERT

[Composite Monitor ã®åˆ¤å®š]
- L0-Composite: OKï¼ˆL0ã¯æ­£å¸¸ï¼‰
- L1-Composite: OKï¼ˆL1ã¯æ­£å¸¸ï¼‰
- L2-Composite: (FR-002-5 = ALERT) AND NOT L0-Composite AND NOT L1-Composite â†’ TRUEï¼ˆé€šçŸ¥ã™ã‚‹ï¼‰
- L3-Composite-tenant-a: (FR-003-1 = ALERT) AND NOT L0-Composite AND NOT L1-Composite AND NOT L2-Composite â†’ FALSEï¼ˆé€šçŸ¥ã—ãªã„ï¼‰

[é‹ç”¨ãƒãƒ¼ãƒ ã¸ã®é€šçŸ¥]
- L2-Composite ã®ã‚¢ãƒ©ãƒ¼ãƒˆã®ã¿é€šçŸ¥
- é‹ç”¨ãƒãƒ¼ãƒ ã¯ã€ŒE2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—ã€ã‚’èªè­˜ã—ã€ALB/ECS/RDSç–é€šã‚’ç¢ºèª
```

**çµæœ**: L3ã‚¢ãƒ©ãƒ¼ãƒˆã¯æŠ‘åˆ¶ã•ã‚Œã€é‹ç”¨ãƒãƒ¼ãƒ ã¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å•é¡Œã«é›†ä¸­ã€‚

### ã‚·ãƒŠãƒªã‚ª4: L3éšœå®³ï¼ˆtenant-a ã®ã¿ã®å•é¡Œï¼‰

```
[ç™ºç”Ÿ]
1. tenant-a ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã«ãƒã‚° â†’ L3-Error-tenant-a ãŒ ALERT
2. tenant-a ã®RDSç–é€šã‚‚å•é¡Œãªã— â†’ FR-003-1 ã¯ OK

[Composite Monitor ã®åˆ¤å®š]
- L0-Composite: OKï¼ˆL0ã¯æ­£å¸¸ï¼‰
- L1-Composite: OKï¼ˆL1ã¯æ­£å¸¸ï¼‰
- L2-Composite: OKï¼ˆL2ã¯æ­£å¸¸ï¼‰
- L3-Composite-tenant-a: (L3-Error-tenant-a = ALERT) AND NOT L0-Composite AND NOT L1-Composite AND NOT L2-Composite â†’ TRUEï¼ˆé€šçŸ¥ã™ã‚‹ï¼‰

[é‹ç”¨ãƒãƒ¼ãƒ ã¸ã®é€šçŸ¥]
- L3-Composite-tenant-a ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é€šçŸ¥
- é‹ç”¨ãƒãƒ¼ãƒ ã¯ã€Œtenant-a å›ºæœ‰ã®å•é¡Œã€ã¨èªè­˜ã—ã€é–‹ç™ºãƒãƒ¼ãƒ ã« escalate
```

**çµæœ**: ãƒ†ãƒŠãƒ³ãƒˆå›ºæœ‰ã®å•é¡Œã¨ã—ã¦æ­£ã—ãé€šçŸ¥ã€‚ä»–ã®ãƒ†ãƒŠãƒ³ãƒˆã«å½±éŸ¿ãªã—ã€‚

## 5. Monitor è©³ç´°è¨­è¨ˆ

### 5.1 L0 Monitor è©³ç´°

#### L0-RDS-CPUï¼ˆRDS CPUä½¿ç”¨ç‡ï¼‰

```yaml
Type: Metric Monitor
Query: avg(last_5m):avg:aws.rds.cpuutilization{dbinstanceidentifier:myapp-db} > 95
Message: |
  [L0] RDS CPUä½¿ç”¨ç‡ãŒ95%ã‚’è¶…ãˆã¾ã—ãŸã€‚
  - DB: {{dbinstanceidentifier.name}}
  - CPU: {{value}}%
  - å½±éŸ¿: å…¨ãƒ†ãƒŠãƒ³ãƒˆ

Thresholds:
  critical: 95
  warning: 80

Tags:
  - layer:l0
  - resource:rds
  - severity:critical
```

#### L0-VPC-Flowï¼ˆVPC Flow Logsç•°å¸¸ï¼‰

```yaml
Type: Log Monitor
Query: logs("source:vpc-flow-logs status:reject").rollup("count").last("5m") > 100
Message: |
  [L0] VPC Flow Logsã§ç•°å¸¸ãªãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’æ¤œçŸ¥ã—ã¾ã—ãŸã€‚
  - Rejected Packets: {{value}}
  - å½±éŸ¿: å…¨ãƒ†ãƒŠãƒ³ãƒˆ

Thresholds:
  critical: 100
  warning: 50

Tags:
  - layer:l0
  - resource:vpc
  - severity:high
```

### 5.2 L1 Monitor è©³ç´°

#### L1-ECS-Tasksï¼ˆECS Running Tasksï¼‰

```yaml
Type: Metric Monitor
Query: avg(last_5m):avg:aws.ecs.running_tasks_count{clustername:myapp-cluster} <= 0
Message: |
  [L1] ECS Clusterã§ã‚¿ã‚¹ã‚¯ãŒ0ã«ãªã‚Šã¾ã—ãŸã€‚
  - Cluster: {{clustername.name}}
  - å½±éŸ¿: å…¨ãƒ†ãƒŠãƒ³ãƒˆï¼ˆã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ï¼‰

Thresholds:
  critical: 0
  warning: 1

Tags:
  - layer:l1
  - resource:ecs
  - severity:critical
```

### 5.3 L2 Monitor è©³ç´°

#### L2-ALB-Healthï¼ˆALB Target Group Healthï¼‰

```yaml
Type: Metric Monitor
Query: avg(last_5m):avg:aws.applicationelb.healthy_host_count{targetgroup:myapp-tg} <= 0
Message: |
  [L2] ALB Target Groupã®ãƒ˜ãƒ«ã‚·ãƒ¼ãƒ›ã‚¹ãƒˆãŒ0ã«ãªã‚Šã¾ã—ãŸã€‚
  - Target Group: {{targetgroup.name}}
  - å½±éŸ¿: å…¨ãƒ†ãƒŠãƒ³ãƒˆï¼ˆã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ï¼‰

Thresholds:
  critical: 0
  warning: 1

Tags:
  - layer:l2
  - resource:alb
  - severity:critical
```

#### L2-ECS-Taskï¼ˆECS Taskç•°å¸¸åœæ­¢ï¼‰

```yaml
Type: Event Monitor
Query: events("source:ecs status:error ecs.cluster-name:myapp-cluster").rollup("count").last("5m") > 0
Message: |
  [L2] ECS TaskãŒç•°å¸¸åœæ­¢ã—ã¾ã—ãŸã€‚
  - Cluster: myapp-cluster
  - å½±éŸ¿: è©²å½“ãƒ†ãƒŠãƒ³ãƒˆ

Thresholds:
  critical: 0

Tags:
  - layer:l2
  - resource:ecs
  - severity:high
```

**ä¿®æ­£ç®‡æ‰€**: ã‚¯ã‚¨ãƒªã‚’å…·ä½“çš„ãªECSã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ã‚¯ã‚¨ãƒªã«å¤‰æ›´ã€‚

#### FR-002-5: ALBâ†’APIâ†’RDS E2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆæ–°è¦è¿½åŠ ï¼‰

```yaml
Type: Synthetic Monitoring (HTTP Check)
Request:
  Method: GET
  URL: https://{ALB_FQDN}/health

Assertions:
  - statusCode is 200
  - responseTime lessThan 5000 (ms)

Message: |
  [L2] ALBâ†’APIâ†’RDS E2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚
  - URL: https://{ALB_FQDN}/health
  - å½±éŸ¿: å…¨ãƒ†ãƒŠãƒ³ãƒˆï¼ˆã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ã®å¯èƒ½æ€§ï¼‰
  - ç¢ºèªå†…å®¹: ALB â†’ ECS â†’ RDS ç–é€š

Thresholds:
  critical: 3å›é€£ç¶šå¤±æ•—

Tags:
  - layer:l2
  - resource:e2e
  - severity:critical

Locations:
  - aws:ap-northeast-1

Frequency: 5åˆ†ã”ã¨
```

### 5.4 L3 Monitor è©³ç´°

#### FR-003-1: ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆRDSç–é€šå«ã‚€ã€å¼·åŒ–ï¼‰

**å®Ÿè£…æ–¹æ³•ã®é¸æŠè‚¢**:

| æ–¹æ³• | Datadog ãƒªã‚½ãƒ¼ã‚¹ | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ | æ¨å¥¨ |
|------|----------------|---------|----------|------|
| A. Synthetics Test | `datadog_synthetics_test` (type: `api`) | å¤–éƒ¨ã‹ã‚‰ã®æ­»æ´»ç›£è¦–ã€SSLè¨¼æ˜æ›¸ãƒã‚§ãƒƒã‚¯å¯èƒ½ã€RDSç–é€šç¢ºèª | ã‚³ã‚¹ãƒˆé«˜ï¼ˆãƒ†ãƒŠãƒ³ãƒˆæ•° Ã— æœˆé¡æ–™é‡‘ï¼‰ | æœ¬ç•ªæ¨å¥¨ |
| B. Service Check Monitor | `datadog_monitor` (type: `service check`) + Agent HTTP Check | Agentå´ã§HTTPãƒã‚§ãƒƒã‚¯å®Ÿè¡Œã€ã‚³ã‚¹ãƒˆä½ | Agentè¨­å®šãŒå¿…è¦ | PoCæ¨å¥¨ |

**PoCæ¨å¥¨å®Ÿè£…ï¼ˆB. Service Check Monitorï¼‰**:

```yaml
Type: Service Check Monitor
Query: "http.check".over("url:https://myapp.example.com/tenant-a/health").by("*").last(2).count_by_status()
Message: |
  [L3] tenant-a ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆRDSç–é€šå«ã‚€ï¼‰ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚
  - URL: https://myapp.example.com/tenant-a/health
  - å½±éŸ¿: tenant-a ã®ã¿
  - ç¢ºèªå†…å®¹: ALB â†’ ECS â†’ RDSï¼ˆtenant_id='tenant-a'ï¼‰ç–é€š

Tags:
  - layer:l3
  - tenant:tenant-a
  - severity:high
```

**å‰æ**: Datadog Agentã§ä»¥ä¸‹ã®è¨­å®šãŒå¿…è¦ï¼ˆ`datadog.yaml` ã¾ãŸã¯ ECS Task Definitionï¼‰:

```yaml
# Datadog Agent è¨­å®šï¼ˆECS Task Definitionç’°å¢ƒå¤‰æ•°ï¼‰
DD_HTTP_CHECK_CONFIG: |
  instances:
    - name: tenant-a-health
      url: https://myapp.example.com/tenant-a/health
      timeout: 5
      tags:
        - tenant:tenant-a
```

**Terraformå®Ÿè£…ä¾‹**:
```hcl
resource "datadog_monitor" "health_check" {
  name    = "[L3] ${var.tenant_id} ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆRDSç–é€šå«ã‚€ï¼‰"
  type    = "service check"
  query   = "\"http.check\".over(\"url:${var.health_check_url}\").by(\"*\").last(2).count_by_status()"
  message = <<-EOT
    [L3] ${var.tenant_id} ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆRDSç–é€šå«ã‚€ï¼‰ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚
    - URL: ${var.health_check_url}
    - å½±éŸ¿: ${var.tenant_id} ã®ã¿
    - ç¢ºèªå†…å®¹: ALB â†’ ECS â†’ RDSï¼ˆtenant_id='${var.tenant_id}'ï¼‰ç–é€š
  EOT

  tags = ["layer:l3", "tenant:${var.tenant_id}", "severity:high"]
}
```

**æœ¬ç•ªæ¨å¥¨å®Ÿè£…ï¼ˆA. Synthetics Testï¼‰**:

```hcl
resource "datadog_synthetics_test" "health_check" {
  name    = "[L3] ${var.tenant_id} ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆRDSç–é€šå«ã‚€ï¼‰"
  type    = "api"
  subtype = "http"
  status  = "live"

  request_definition {
    method = "GET"
    url    = var.health_check_url
  }

  assertion {
    type     = "statusCode"
    operator = "is"
    target   = "200"
  }

  assertion {
    type     = "responseTime"
    operator = "lessThan"
    target   = "5000"
  }

  assertion {
    type     = "body"
    operator = "contains"
    target   = "\"status\":\"ok\""
  }

  locations = ["aws:ap-northeast-1"]

  options_list {
    tick_every = 300  # 5åˆ†ã”ã¨
  }

  tags = ["layer:l3", "tenant:${var.tenant_id}"]
}
```

#### L3-Error-tenant-aï¼ˆtenant-a ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°æ•°ï¼‰

```yaml
Type: Log Monitor
Query: logs("status:error tenant:tenant-a").rollup("count").last("5m") > 10
Message: |
  [L3] tenant-a ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒ5åˆ†é–“ã§10ä»¶ã‚’è¶…ãˆã¾ã—ãŸã€‚
  - Count: {{value}}
  - å½±éŸ¿: tenant-a ã®ã¿

Thresholds:
  critical: 10
  warning: 5

Tags:
  - layer:l3
  - tenant:tenant-a
  - severity:medium
```

#### L3-Latency-tenant-aï¼ˆtenant-a ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· p99ï¼‰

```yaml
Type: APM Monitor
Query: avg(last_5m):p99:trace.web.request.duration{service:myapp,tenant:tenant-a} > 1000
Message: |
  [L3] tenant-a ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼ˆp99ï¼‰ãŒ1ç§’ã‚’è¶…ãˆã¾ã—ãŸã€‚
  - Latency: {{value}}ms
  - å½±éŸ¿: tenant-a ã®ã¿

Thresholds:
  critical: 1000
  warning: 500

Tags:
  - layer:l3
  - tenant:tenant-a
  - severity:medium
```

## 6. Composite Monitor ã®è©³ç´°è¨­è¨ˆ

### 6.1 L0-Composite

```yaml
Type: Composite Monitor
Query: |
  L0-RDS-CPU ||
  L0-RDS-Conn ||
  L0-RDS-Mem ||
  L0-RDS-Storage ||
  L0-VPC-Flow ||
  L0-Agent

Message: |
  [L0 Composite] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç›¤ã§éšœå®³ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
  - å½±éŸ¿: å…¨ãƒ†ãƒŠãƒ³ãƒˆ
  - å¯¾å¿œ: ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ãŒèª¿æŸ»ä¸­

Tags:
  - layer:l0
  - composite:true
  - severity:critical

Notification:
  - Slack: #ops-alerts-critical
  - PagerDuty: ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ 
```

### 6.2 L1-Composite

```yaml
Type: Composite Monitor
Query: |
  L1-ECS-Tasks
  && NOT L0-Composite

Message: |
  [L1 Composite] ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆåŸºç›¤ã§éšœå®³ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
  - å½±éŸ¿: å…¨ãƒ†ãƒŠãƒ³ãƒˆ
  - å¯¾å¿œ: ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ãŒèª¿æŸ»ä¸­

  æ³¨: L0éšœå®³ä¸­ã®å ´åˆã€ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã¯æŠ‘åˆ¶ã•ã‚Œã¾ã™ã€‚

Tags:
  - layer:l1
  - composite:true
  - severity:critical

Notification:
  - Slack: #ops-alerts-critical
  - PagerDuty: ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ 
```

### 6.3 L2-Composite

```yaml
Type: Composite Monitor
Query: |
  (L2-ALB-Health || L2-ECS-Task || L2-ECR-Vuln || FR-002-5)
  && NOT L0-Composite
  && NOT L1-Composite

Message: |
  [L2 Composite] ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§éšœå®³ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
  - å½±éŸ¿: è©²å½“ã‚µãƒ¼ãƒ“ã‚¹
  - å¯¾å¿œ: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒ ãŒèª¿æŸ»ä¸­

  æ³¨: L0/L1éšœå®³ä¸­ã®å ´åˆã€ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã¯æŠ‘åˆ¶ã•ã‚Œã¾ã™ã€‚

Tags:
  - layer:l2
  - composite:true
  - severity:high

Notification:
  - Slack: #ops-alerts-high
  - Email: app-team@example.com
```

### 6.4 L3-Composite-tenant-a

```yaml
Type: Composite Monitor
Query: |
  (FR-003-1 || L3-Error-tenant-a || L3-Latency-tenant-a)
  && NOT L0-Composite
  && NOT L1-Composite
  && NOT L2-Composite

Message: |
  [L3 Composite] tenant-a ã§éšœå®³ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
  - å½±éŸ¿: tenant-a ã®ã¿
  - å¯¾å¿œ: é–‹ç™ºãƒãƒ¼ãƒ ãŒèª¿æŸ»ä¸­

  æ³¨: L0/L1/L2éšœå®³ä¸­ã®å ´åˆã€ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã¯æŠ‘åˆ¶ã•ã‚Œã¾ã™ã€‚

Tags:
  - layer:l3
  - tenant:tenant-a
  - composite:true
  - severity:medium

Notification:
  - Slack: #tenant-a-alerts
  - Email: dev-team@example.com
```

## 7. ãƒ†ãƒŠãƒ³ãƒˆè¿½åŠ æ™‚ã®ç›£è¦–è¨­è¨ˆ

### 7.1 ãƒ†ãƒŠãƒ³ãƒˆè¿½åŠ ãƒ•ãƒ­ãƒ¼

```
1. tfvars ã«ãƒ†ãƒŠãƒ³ãƒˆè¿½åŠ 
   tenants = {
     tenant-a = { errors_threshold = 10, latency_threshold = 1000 }
     tenant-b = { errors_threshold = 10, latency_threshold = 1000 }  # è¿½åŠ 
   }

2. terraform planï¼ˆdry-runï¼‰
   - L3 Monitorï¼ˆ3å€‹ï¼‰ãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - L3 Composite Monitorï¼ˆ1å€‹ï¼‰ãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

3. terraform apply
   - è‡ªå‹•çš„ã« tenant-b ç”¨ã® L3 Monitor ãŒä½œæˆã•ã‚Œã‚‹
   - è‡ªå‹•çš„ã« tenant-b ç”¨ã® L3 Composite Monitor ãŒä½œæˆã•ã‚Œã‚‹
```

### 7.2 ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ã®é–¾å€¤ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

```hcl
# terraform/terraform.tfvars
tenants = {
  tenant-a = {
    errors_threshold  = 10  # ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°é–¾å€¤
    latency_threshold = 1000  # ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·é–¾å€¤ï¼ˆmsï¼‰
  }
  tenant-b = {
    errors_threshold  = 20  # tenant-b ã¯é–¾å€¤ã‚’ç·©ãè¨­å®š
    latency_threshold = 1500
  }
  tenant-c = {
    errors_threshold  = 5  # tenant-c ã¯é–¾å€¤ã‚’å³ã—ãè¨­å®š
    latency_threshold = 500
  }
}
```

**ãƒ¡ãƒªãƒƒãƒˆ**: ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ç•°ãªã‚‹SLA/é–¾å€¤ã‚’è¨­å®šå¯èƒ½ã€‚

## 8. ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥è¨­è¨ˆ

### 8.1 é€šçŸ¥å…ˆã®éšå±¤åŒ–

| éšå±¤ | é€šçŸ¥å…ˆ | å¯¾å¿œè€… | ç·Šæ€¥åº¦ |
|------|-------|-------|--------|
| L0 Composite | Slack: #ops-alerts-critical<br/>PagerDuty: ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ  | ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ï¼ˆ24/7ï¼‰ | Criticalï¼ˆå³åº§å¯¾å¿œï¼‰ |
| L1 Composite | Slack: #ops-alerts-critical<br/>PagerDuty: ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ  | ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ï¼ˆ24/7ï¼‰ | Criticalï¼ˆå³åº§å¯¾å¿œï¼‰ |
| L2 Composite | Slack: #ops-alerts-high<br/>Email: app-team@example.com | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒ  | Highï¼ˆ1æ™‚é–“ä»¥å†…ï¼‰ |
| L3 Composite | Slack: #tenant-{tenant_id}-alerts<br/>Email: dev-team@example.com | é–‹ç™ºãƒãƒ¼ãƒ  | Mediumï¼ˆå–¶æ¥­æ™‚é–“å†…ï¼‰ |

### 8.2 é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

#### L0 Composite é€šçŸ¥ä¾‹

```
ğŸš¨ [CRITICAL] L0 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³

éšœå®³å†…å®¹: RDS CPUä½¿ç”¨ç‡ãŒ95%ã‚’è¶…ãˆã¾ã—ãŸ
å½±éŸ¿ç¯„å›²: å…¨ãƒ†ãƒŠãƒ³ãƒˆ
å¯¾å¿œè€…: ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ 
å¯¾å¿œçŠ¶æ³: èª¿æŸ»ä¸­

è©³ç´°: https://app.datadoghq.com/monitors/12345
```

#### L3 Composite é€šçŸ¥ä¾‹

```
âš ï¸ [MEDIUM] L3 ãƒ†ãƒŠãƒ³ãƒˆéšœå®³

éšœå®³å†…å®¹: tenant-a ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒ5åˆ†é–“ã§10ä»¶ã‚’è¶…ãˆã¾ã—ãŸ
å½±éŸ¿ç¯„å›²: tenant-a ã®ã¿
å¯¾å¿œè€…: é–‹ç™ºãƒãƒ¼ãƒ 
å¯¾å¿œçŠ¶æ³: èª¿æŸ»ä¸­

è©³ç´°: https://app.datadoghq.com/monitors/67890
```

## 9. ç›£è¦–ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒæœŸé–“

| ãƒ‡ãƒ¼ã‚¿ç¨®åˆ¥ | ä¿æŒæœŸé–“ | å‚™è€ƒ |
|---------|---------|------|
| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | 15ãƒ¶æœˆ | Datadog æ¨™æº–ãƒ—ãƒ©ãƒ³ |
| ãƒ­ã‚° | 15æ—¥é–“ | Datadog ãƒ­ã‚°ç®¡ç†ãƒ—ãƒ©ãƒ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |
| ãƒˆãƒ¬ãƒ¼ã‚¹ | 15æ—¥é–“ | Datadog APM ãƒ—ãƒ©ãƒ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |
| ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ | 90æ—¥é–“ | Datadog Audit Trail |

**æ³¨**: PoCã§ã¯ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé–“ã®ä¿æŒæœŸé–“ã«å¾“ã„ã¾ã™ã€‚

## 10. ç›£è¦–è¨­è¨ˆã®æ¤œè¨¼æ–¹æ³•

### 10.1 PoCæ¤œè¨¼ã‚·ãƒŠãƒªã‚ª

| ã‚·ãƒŠãƒªã‚ª | æ“ä½œ | æœŸå¾…çµæœ |
|---------|------|---------|
| L0éšœå®³ãƒ†ã‚¹ãƒˆ | RDS CPUè² è·ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§95%è¶…ã«è¨­å®š | L0-Composite ã®ã¿ã‚¢ãƒ©ãƒ¼ãƒˆã€L1/L2/L3ã¯æŠ‘åˆ¶ |
| L1éšœå®³ãƒ†ã‚¹ãƒˆ | ECS Tasksã‚’æ‰‹å‹•åœæ­¢ï¼ˆ`aws ecs update-service --desired-count 0`ï¼‰ | L1-Composite ã®ã¿ã‚¢ãƒ©ãƒ¼ãƒˆã€L2/L3ã¯æŠ‘åˆ¶ |
| L2éšœå®³ãƒ†ã‚¹ãƒˆï¼ˆE2Eï¼‰ | `/health` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æ„å›³çš„ã«å¤±æ•— | L2-Composite ã®ã¿ã‚¢ãƒ©ãƒ¼ãƒˆã€L3ã¯æŠ‘åˆ¶ |
| L2éšœå®³ãƒ†ã‚¹ãƒˆï¼ˆECSï¼‰ | ECS Taskã‚’æ‰‹å‹•åœæ­¢ï¼ˆ`aws ecs stop-task`ï¼‰ | L2-Composite ã®ã¿ã‚¢ãƒ©ãƒ¼ãƒˆã€L3ã¯æŠ‘åˆ¶ |
| L3éšœå®³ãƒ†ã‚¹ãƒˆ | tenant-a ã®ã‚¢ãƒ—ãƒªã§æ„å›³çš„ã«ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ | L3-Composite-tenant-a ã®ã¿ã‚¢ãƒ©ãƒ¼ãƒˆ |

### 10.2 æ¤œè¨¼æ‰‹é †ï¼ˆè©³ç´°ã¯è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚ºã§å®šç¾©ï¼‰

```bash
# L0éšœå®³ãƒ†ã‚¹ãƒˆï¼ˆRDS CPUè² è·ï¼‰
# â€»è©³ç´°æ‰‹é †ã¯åˆ¥é€”å®šç¾©ï¼ˆAWS CLI ã¾ãŸã¯æ‰‹å‹•æ“ä½œï¼‰

# L1éšœå®³ãƒ†ã‚¹ãƒˆï¼ˆECS Taskså…¨åœæ­¢ï¼‰
aws ecs update-service --cluster myapp-cluster --service demo-api --desired-count 0

# L2éšœå®³ãƒ†ã‚¹ãƒˆï¼ˆE2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—ï¼‰
curl -X POST https://myapp.example.com/admin/disable-health

# L2éšœå®³ãƒ†ã‚¹ãƒˆï¼ˆECS Taskåœæ­¢ï¼‰
aws ecs stop-task --cluster myapp-cluster --task <task-id>

# L3éšœå®³ãƒ†ã‚¹ãƒˆï¼ˆã‚¢ãƒ—ãƒªã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼‰
curl -X POST https://myapp.example.com/tenant-a/trigger-error
```

## 11. ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—æ¤œè¨¼

### 11.1 ç›®çš„
APM Service Mapã«ã‚ˆã‚Šã€ALB â†’ ECS â†’ RDS ã®ä¾å­˜é–¢ä¿‚ã‚’å¯è¦–åŒ–ã—ã€éšœå®³æ™‚ã®å½±éŸ¿ç¯„å›²ã‚’æŠŠæ¡ã™ã‚‹ã€‚

### 11.2 å‰ææ¡ä»¶
- Unified Service Tagging(DD_SERVICE, DD_ENV, DD_VERSION)ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨
- APMãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨(DD_APM_ENABLED=true)
- Datadog Agent ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãŒECSã‚¿ã‚¹ã‚¯ã§ç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨

### 11.3 æ¤œè¨¼é …ç›®

| é …ç›® | ç¢ºèªå ´æ‰€ | æœŸå¾…çµæœ |
|------|---------|---------|
| ã‚µãƒ¼ãƒ“ã‚¹è¡¨ç¤º | APM > Service Map | `demo-api` ãŒè¡¨ç¤ºã•ã‚Œã‚‹ |
| ä¾å­˜é–¢ä¿‚ | Service Map | `demo-api â†’ postgresql` ã®çŸ¢å°è¡¨ç¤º |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚° | APM > Service Catalog | `version:1.0.0` ä»˜ä¸ç¢ºèª |
| ãƒˆãƒ¬ãƒ¼ã‚¹è¿½è·¡ | APM > Traces | `/tenant-a/items` â†’ RDSã‚¯ã‚¨ãƒªã¾ã§è¿½è·¡å¯èƒ½ |
| ã‚¨ãƒ©ãƒ¼è¿½è·¡ | APM > Traces (status:error) | ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç®‡æ‰€ãŒç‰¹å®šå¯èƒ½ |

### 11.4 æ¤œè¨¼æ‰‹é †

**ã‚¹ãƒ†ãƒƒãƒ—1: ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—ç¢ºèª**
1. Datadog > APM > Service Map ã‚’é–‹ã
2. `demo-api` ã‚µãƒ¼ãƒ“ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. `demo-api â†’ postgresql` ã®ä¾å­˜é–¢ä¿‚ãŒçŸ¢å°ã§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

**ã‚¹ãƒ†ãƒƒãƒ—2: ãƒˆãƒ¬ãƒ¼ã‚¹è¿½è·¡ç¢ºèª**
```bash
# æ­£å¸¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
curl -X GET https://${ALB_DNS}/tenant-a/items

# Datadog > APM > Traces ã§ç¢ºèª
# ãƒ•ã‚£ãƒ«ã‚¿: service:demo-api
# æœŸå¾…: fastapi.request â†’ postgresql.query ã®ã‚¹ãƒ‘ãƒ³éšå±¤
```

**ã‚¹ãƒ†ãƒƒãƒ—3: ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ¼ã‚¹ç¢ºèª**
```bash
# ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
curl -X POST https://${ALB_DNS}/tenant-a/simulate/error \
  -H "Content-Type: application/json" \
  -d '{"count": 1}'

# Datadog > APM > Traces ã§ç¢ºèª
# ãƒ•ã‚£ãƒ«ã‚¿: service:demo-api status:error
# æœŸå¾…: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç®‡æ‰€ã¨ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒç¢ºèªå¯èƒ½
```

## 12. æ§‹é€ åŒ–ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä»•æ§˜

### 12.1 æ¦‚è¦

L3ç›£è¦–ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼‰ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã¯æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆJSONå½¢å¼ï¼‰ã§å‡ºåŠ›ã—ã¾ã™ã€‚

### 12.2 ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä»•æ§˜

**JSONå½¢å¼ï¼ˆæ¨å¥¨ï¼‰**:

```json
{
  "timestamp": "2025-12-28T12:34:56.789Z",
  "level": "error",
  "message": "Database connection timeout",
  "tenant": "tenant-a",
  "service": "myapp",
  "trace_id": "abc123def456",
  "span_id": "789ghi012jkl",
  "error": {
    "type": "DatabaseError",
    "stack": "..."
  },
  "request": {
    "method": "GET",
    "path": "/api/users",
    "user_id": "user-123"
  }
}
```

### 12.3 å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ | ä¾‹ |
|---------|------|------|------|
| `timestamp` | ISO8601 | ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— | `2025-12-28T12:34:56.789Z` |
| `level` | string | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ï¼ˆ`error`, `warn`, `info`, `debug`ï¼‰ | `error` |
| `message` | string | ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | `Database connection timeout` |
| `tenant` | string | ãƒ†ãƒŠãƒ³ãƒˆè­˜åˆ¥å­ï¼ˆ**L3ç›£è¦–ã§å¿…é ˆ**ï¼‰ | `tenant-a` |
| `service` | string | ã‚µãƒ¼ãƒ“ã‚¹å | `myapp` |

### 12.4 æ¨å¥¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ | ä¾‹ |
|---------|------|------|------|
| `trace_id` | string | Datadog APM ãƒˆãƒ¬ãƒ¼ã‚¹ID | `abc123def456` |
| `span_id` | string | Datadog APM ã‚¹ãƒ‘ãƒ³ID | `789ghi012jkl` |
| `error.type` | string | ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ— | `DatabaseError` |
| `error.stack` | string | ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ | `...` |
| `request.method` | string | HTTPãƒ¡ã‚½ãƒƒãƒ‰ | `GET` |
| `request.path` | string | ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¹ | `/api/users` |

### 12.5 ãƒ­ã‚°å‡ºåŠ›å…ˆ

| ç’°å¢ƒ | å‡ºåŠ›å…ˆ | å‚™è€ƒ |
|------|--------|------|
| ECS Fargate | CloudWatch Logs | Datadog AgentãŒè‡ªå‹•åé›† |
| ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º | stdout | JSONå½¢å¼ã§å‡ºåŠ› |

### 12.6 Datadog ãƒ­ã‚°ãƒ‘ãƒ¼ã‚¹è¨­å®š

**Datadog UI ã§ã®è¨­å®š**ï¼ˆLogs â†’ Configuration â†’ Pipelinesï¼‰:

```yaml
# Pipeline: myapp-logs
Processor:
  - type: grok-parser
    name: Parse JSON logs
    source: message
    samples:
      - '{"timestamp":"2025-12-28T12:34:56.789Z","level":"error","message":"test","tenant":"tenant-a"}'
    grok:
      supportRules: ''
      matchRules: '%{data:json}'
  - type: json-parser
    name: Extract JSON fields
    source: json
```

**ã¾ãŸã¯ã€Terraform ã§è¨­å®š**:

```hcl
resource "datadog_logs_custom_pipeline" "myapp_logs" {
  name       = "myapp-logs"
  is_enabled = true

  filter {
    query = "service:myapp"
  }

  processor {
    json_parser {
      name    = "Extract JSON fields"
      sources = ["message"]
    }
  }
}
```

### 12.7 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆã¨ã®æ•´åˆæ€§

**å‚ç…§**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆæ›¸ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰ã¨æ§‹é€ åŒ–ãƒ­ã‚°ä»•æ§˜ã‚’æ•´åˆã•ã›ã¦ãã ã•ã„ã€‚

- ãƒ­ã‚®ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒª: ã‚¢ãƒ—ãƒªå´ã§é¸å®šï¼ˆä¾‹: Winston, Bunyan, structlogç­‰ï¼‰
- ãƒ†ãƒŠãƒ³ãƒˆè­˜åˆ¥å­ã®æ³¨å…¥æ–¹æ³•: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰è‡ªå‹•æ³¨å…¥
- Datadog APMçµ±åˆ: `trace_id`, `span_id` ã®è‡ªå‹•æ³¨å…¥

## 13. ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤æ¸¬å®šæ–¹æ³•

### 13.1 æ¸¬å®šæŒ‡æ¨™

| æŒ‡æ¨™ | æ¸¬å®šæ–¹æ³• | ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ |
|------|---------|------------|
| MTTDï¼ˆMean Time To Detectï¼‰ | ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç«ã€œæ¤œçŸ¥ã¾ã§ã®æ™‚é–“ | éšœå®³æ¤œçŸ¥ã®è¿…é€Ÿæ€§ |
| MTTRï¼ˆMean Time To Resolveï¼‰ | ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç«ã€œå¾©æ—§ã¾ã§ã®æ™‚é–“ | éšœå®³å¾©æ—§ã®è¿…é€Ÿæ€§ |
| ã‚¢ãƒ©ãƒ¼ãƒˆç²¾åº¦ï¼ˆPrecisionï¼‰ | çœŸé™½æ€§ã‚¢ãƒ©ãƒ¼ãƒˆæ•° / å…¨ã‚¢ãƒ©ãƒ¼ãƒˆæ•° | ã‚¢ãƒ©ãƒ¼ãƒˆç–²åŠ´ã®å‰Šæ¸› |
| L0/L1/L2/L3 ã‚¢ãƒ©ãƒ¼ãƒˆæ¯”ç‡ | å„éšå±¤ã®ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿé »åº¦ | æ ¹æœ¬åŸå› ã®å¯è¦–åŒ– |

### 13.2 Datadog Metrics ã§ã®è¨ˆæ¸¬

**Custom Metric é€ä¿¡**ï¼ˆDatadog Agent ã¾ãŸã¯ APIï¼‰:

```python
# Pythonä¾‹ï¼ˆDatadog APIï¼‰
from datadog import statsd

# ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾å¿œé–‹å§‹
statsd.event(
    title="Alert Response Started",
    text="L0-Composite Alert",
    tags=["layer:l0", "phase:detection"]
)

# ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾å¿œå®Œäº†
statsd.event(
    title="Alert Resolved",
    text="L0-Composite Resolved",
    tags=["layer:l0", "phase:resolution"]
)

# MTTRè¨ˆç®—ï¼ˆDatadog UI ã§ã‚¤ãƒ™ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹è¨ˆæ¸¬ï¼‰
# Events â†’ MTTD/MTTR Dashboard
```

### 13.3 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¨­è¨ˆ

**Datadog Dashboard**ï¼ˆTerraform ã§ä½œæˆå¯èƒ½ï¼‰:

```hcl
resource "datadog_dashboard" "mttr_dashboard" {
  title       = "MTTD/MTTR Dashboard"
  description = "ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾å¿œæ™‚é–“ã®å¯è¦–åŒ–"
  layout_type = "ordered"

  widget {
    timeseries_definition {
      title = "MTTRï¼ˆå¹³å‡å¾©æ—§æ™‚é–“ï¼‰"
      request {
        q = "avg:alert.resolution.duration{*} by {layer}"
      }
    }
  }

  widget {
    query_value_definition {
      title = "ä»Šæœˆã®å¹³å‡MTTR"
      request {
        q          = "avg:alert.resolution.duration{*}"
        aggregator = "avg"
      }
    }
  }
}
```

**æ¸¬å®šæ–¹æ³•**:
1. ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç«æ™‚ã« `detection` ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡
2. å¾©æ—§æ™‚ã« `resolution` ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡
3. Datadog Events APIã§ `resolution.duration` ã‚’è¨ˆç®—
4. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ã‚’å¯è¦–åŒ–

## 14. ç›£è¦–æ•°ã®å¤‰æ›´

### ä¿®æ­£å‰ã®ç›£è¦–æ•°

| å±¤ | ç›£è¦–æ•° |
|-----|--------|
| L0 | 7å€‹ |
| L2 | 3å€‹ |
| L3ï¼ˆãƒ†ãƒŠãƒ³ãƒˆã”ã¨ï¼‰ | 3å€‹ |

### ä¿®æ­£å¾Œã®ç›£è¦–æ•°ï¼ˆ4å±¤ã«åˆ†å‰²ï¼‰

| å±¤ | ç›£è¦–æ•° |
|-----|--------|
| L0ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰ | 6å€‹ï¼ˆRDSÃ—4ã€VPCÃ—1ã€AgentÃ—1ï¼‰ |
| L1ï¼ˆã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆï¼‰ | 1å€‹ï¼ˆECSÃ—1ï¼‰ |
| L2ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰ | 4å€‹ï¼ˆALBÃ—1ã€ECS TaskÃ—1ã€ECRÃ—1ã€E2EÃ—1ï¼‰ |
| L3ï¼ˆãƒ†ãƒŠãƒ³ãƒˆã”ã¨ï¼‰ | 3å€‹ï¼ˆHealthÃ—1ã€ErrorÃ—1ã€LatencyÃ—1ï¼‰ |

**å½±éŸ¿**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆã®æ›´æ–°ãŒå¿…è¦ã€‚

## 15. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ãƒ‘ã‚¹ |
|-------------|------|
| ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ | [01_ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³.md](01_ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³.md) |
| IaCæ§‹æˆæ–¹é‡ | [10_IaCæ–¹é‡.md](10_IaCæ–¹é‡.md) |
| è¦ä»¶å®šç¾©æ›¸ | ../../02_è¦ä»¶å®šç¾©/è¦ä»¶å®šç¾©æ›¸.md |

---

**ä½œæˆæ—¥**: 2025-12-28
**ä½œæˆè€…**: Infra-Architect
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.4
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Draft
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜…ï¼ˆæœ¬PoCã®æ ¸å¿ƒï¼‰
**å¤‰æ›´å±¥æ­´**:
- 1.1 (2025-12-28): L2-ECS-Taskã‚¯ã‚¨ãƒªå…·ä½“åŒ–ã€L3-Healthãƒã‚§ãƒƒã‚¯å®Ÿè£…æ–¹æ³•æ˜ç¤ºã€æ§‹é€ åŒ–ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä»•æ§˜è¿½è¨˜ã€MTTRæ¸¬å®šæ–¹æ³•è¿½è¨˜
- 1.2 (2025-12-28): L1çœç•¥ã®ç†ç”±ã‚’æ˜è¨˜ã€FR-002-5ï¼ˆL2 E2Eãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰è¿½åŠ ã€FR-003-1ï¼ˆL3ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰å¼·åŒ–ï¼ˆRDSç–é€šå«ã‚€ï¼‰
- 1.3 (2025-12-31): ç›£è¦–éšå±¤ã‚’3å±¤(L0/L2/L3)ã‹ã‚‰4å±¤(L0/L1/L2/L3)ã«å¤‰æ›´ã€L1ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆå±¤ã‚’è¿½åŠ ã€Composite Monitorè¦ªå­é–¢ä¿‚ã‚’æ›´æ–°ã€å…¨ã‚·ãƒŠãƒªã‚ªã‚’4å±¤å¯¾å¿œã«ä¿®æ­£
- 1.4 (2025-12-31): Â§11 ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—æ¤œè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ ã€Unified Service Taggingã«DD_VERSIONè¿½è¨˜
