# 環境別パラメータ

## 1. 概要

このドキュメントは、terraform.tfvars で使用するパラメータの定義を記載します。

---

## 2. PoC環境（1環境のみ）

### 2.1 terraform.tfvars の作成

```hcl
# terraform.tfvars

# ⚠️ Datadog API Key/APP Key は環境変数で注入してください:
#   $env:TF_VAR_datadog_api_key = $env:DD_API_KEY
#   $env:TF_VAR_datadog_app_key = $env:DD_APP_KEY
# terraform.tfvarsには一切記載しないでください

# AWS リソース識別子
rds_instance_id     = "myapp-db"
ecs_cluster_name    = "myapp-cluster"
alb_target_group    = "myapp-tg"
ecr_repository_name = "myapp"
app_domain          = "myapp.example.com"

# 閾値
rds_cpu_threshold = 95

# テナント定義⭐
tenants = {
  tenant-a = {
    errors_threshold  = 10
    latency_threshold = 1000
  }
  tenant-b = {
    errors_threshold  = 10
    latency_threshold = 1000
  }
  tenant-c = {
    errors_threshold  = 10
    latency_threshold = 1000
  }
}

# 通知先（階層別）
notification_channels_l0 = [
  "@slack-ops-alerts-critical",
  "@pagerduty-infra-team"
]

notification_channels_l2 = [
  "@slack-ops-alerts-high",
  "@app-team@example.com"
]

notification_channels_l3 = [
  "@slack-tenant-alerts",
  "@dev-team@example.com"
]

notification_channels_composite = [
  "@slack-ops-alerts"
]

# 共通タグ
common_tags = {
  project     = "datadog-poc"
  environment = "poc"
  managed_by  = "terraform"
}
```

---

## 3. 本番移行時の環境管理（参考）

### 3.1 環境別ディレクトリ構成

```
terraform/
├── main.tf
├── variables.tf
├── outputs.tf
├── providers.tf
├── backend.tf
├── modules/
└── environments/
    ├── poc/
    │   └── terraform.tfvars
    ├── staging/
    │   └── terraform.tfvars
    └── production/
        └── terraform.tfvars
```

### 3.2 環境別デプロイ方法

```powershell
# PoC環境
terraform apply -var-file=environments/poc/terraform.tfvars

# Staging環境
terraform apply -var-file=environments/staging/terraform.tfvars

# Production環境
terraform apply -var-file=environments/production/terraform.tfvars
```

---

## 4. 関連ドキュメント

| ドキュメント | パス |
|------------|------|
| ルートモジュール詳細設計 | [01_ルートモジュール詳細設計.md](01_ルートモジュール詳細設計.md) |
| デプロイ手順書 | [03_デプロイ手順書.md](03_デプロイ手順書.md) |

---

**作成日**: 2025-12-28
**作成者**: Infra-Architect
**バージョン**: 1.0
**ステータス**: Draft
