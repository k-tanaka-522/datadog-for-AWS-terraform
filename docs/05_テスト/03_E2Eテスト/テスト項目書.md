# E2Eテスト項目書

## 1. ドキュメント情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | Datadog for AWS Terraform PoC |
| フェーズ | E2Eテスト |
| バージョン | 1.0 |
| 作成日 | 2025-12-28 |
| 作成者 | QA |
| ステータス | Draft |

---

## 2. アラートストーム防止検証テスト項目

### 2.1 L0障害時のアラート抑制

| テストID | テストケース | 手順 | 期待結果 | 優先度 | 実施状況 |
|---------|------------|------|---------|--------|---------|
| E2E-001 | L0障害時のアラート抑制 | 1. L0-RDS-CPU をALERT状態に設定<br>2. L2-ALB-Health をALERT状態に設定<br>3. L3-Error-tenant-a をALERT状態に設定<br>4. Composite Monitorアラート確認<br>5. Event Stream確認 | L0-Composite のみ通知送信<br>L2/L3-Composite は抑制 | High | 未実施 |

### 2.2 L2障害時のアラート抑制

| テストID | テストケース | 手順 | 期待結果 | 優先度 | 実施状況 |
|---------|------------|------|---------|--------|---------|
| E2E-002 | L2障害時のアラート抑制 | 1. L2-ALB-Health をALERT状態に設定<br>2. L3-Error-tenant-a をALERT状態に設定<br>3. Composite Monitorアラート確認<br>4. Event Stream確認 | L2-Composite のみ通知送信<br>L3-Composite は抑制<br>L0-Composite は正常 | High | 未実施 |

### 2.3 L3障害のみ

| テストID | テストケース | 手順 | 期待結果 | 優先度 | 実施状況 |
|---------|------------|------|---------|--------|---------|
| E2E-003 | L3障害のみ（親は正常） | 1. L3-Error-tenant-a をALERT状態に設定<br>2. Composite Monitorアラート確認<br>3. Event Stream確認 | L3-Composite-tenant-a のみ通知送信<br>L0/L2-Composite は正常 | High | 未実施 |

---

## 3. IaCデプロイ検証テスト項目

### 3.1 tenant-b 追加デプロイ

| テストID | テストケース | 手順 | 期待結果 | 優先度 | 実施状況 |
|---------|------------|------|---------|--------|---------|
| E2E-004 | tenant-b 追加デプロイ | 1. tfvars に tenant-b 追加<br>2. terraform plan<br>3. terraform apply<br>4. Datadog Monitor確認 | terraform apply 成功<br>tenant-b 用 L3 Monitor 3個<br>tenant-b 用 L3 Composite 1個 作成完了<br>tenant-a に変更なし | High | 未実施 |

### 3.2 tenant-c 追加デプロイ

| テストID | テストケース | 手順 | 期待結果 | 優先度 | 実施状況 |
|---------|------------|------|---------|--------|---------|
| E2E-005 | tenant-c 追加デプロイ | 1. tfvars に tenant-c 追加<br>2. terraform plan<br>3. terraform apply<br>4. Datadog Monitor確認 | terraform apply 成功<br>tenant-c 用 L3 Monitor 3個<br>tenant-c 用 L3 Composite 1個 作成完了<br>tenant-a, tenant-b に変更なし | High | 未実施 |

### 3.3 既存テナントへの影響なし

| テストID | テストケース | 手順 | 期待結果 | 優先度 | 実施状況 |
|---------|------------|------|---------|--------|---------|
| E2E-006 | 既存テナントへの影響なし | 1. tenant-b, tenant-c 追加後<br>2. terraform plan<br>3. tenant-a のMonitor確認 | No changes（差分なし）<br>tenant-a のMonitorに変更なし | High | 未実施 |

---

## 4. 親子関係可視化検証テスト項目

### 4.1 Datadog UI確認

| テストID | テストケース | 手順 | 期待結果 | 優先度 | 実施状況 |
|---------|------------|------|---------|--------|---------|
| E2E-007 | Monitors一覧表示 | 1. Datadog UI > Monitors > Manage Monitors<br>2. フィルタ: tag:env:poc<br>3. スクリーンショット取得 | 階層構造が表示される | Medium | 未実施 |
| E2E-008 | Composite Monitor式確認 | 1. L0-Composite の式確認<br>2. L2-Composite の式確認（NOT条件）<br>3. L3-Composite の式確認（NOT条件） | 式にNOT条件が含まれる | High | 未実施 |

---

## 5. テスト実行記録

### 5.1 テスト実施サマリ

| カテゴリ | 計画数 | 実施数 | 合格数 | 不合格数 | 合格率 |
|--------|-------|-------|-------|---------|--------|
| アラートストーム防止検証 | 3 | - | - | - | - |
| IaCデプロイ検証 | 3 | - | - | - | - |
| 親子関係可視化検証 | 2 | - | - | - | - |
| **合計** | **8** | **-** | **-** | **-** | **-** |

### 5.2 詳細テスト結果（実施後に記入）

#### アラートストーム防止検証

| テストID | 実施日 | 実施者 | 結果 | スクリーンショット | 備考 |
|---------|-------|-------|------|--------------|------|
| E2E-001 | - | QA | - | screenshots/e2e-001-*.png | - |
| E2E-002 | - | QA | - | screenshots/e2e-002-*.png | - |
| E2E-003 | - | QA | - | screenshots/e2e-003-*.png | - |

#### IaCデプロイ検証

| テストID | 実施日 | 実施者 | 結果 | terraform apply結果 | 備考 |
|---------|-------|-------|------|------------------|------|
| E2E-004 | - | QA | - | - | - |
| E2E-005 | - | QA | - | - | - |
| E2E-006 | - | QA | - | - | - |

#### 親子関係可視化検証

| テストID | 実施日 | 実施者 | 結果 | スクリーンショット | 備考 |
|---------|-------|-------|------|--------------|------|
| E2E-007 | - | QA | - | screenshots/e2e-hierarchy.png | - |
| E2E-008 | - | QA | - | screenshots/e2e-composite-formula.png | - |

---

## 6. スクリーンショット一覧

### 6.1 E2E-001: L0障害時のアラート抑制

| ファイル名 | 内容 | 取得タイミング |
|----------|------|-------------|
| e2e-001-step1-initial.png | 初期状態（全Monitor OK） | ステップ1 |
| e2e-001-step2-l0-alert.png | L0 Monitor ALERT | ステップ2 |
| e2e-001-step3-l2-alert.png | L2 Monitor ALERT | ステップ3 |
| e2e-001-step4-l3-alert.png | L3 Monitor ALERT | ステップ4 |
| e2e-001-step5-composite.png | Composite Monitor ALERT | ステップ5 |
| e2e-001-step6-event-stream.png | Event Stream（L0のみ通知） | ステップ6 |
| e2e-001-step7-composite-formula.png | Composite Monitor式（NOT条件） | ステップ7 |

### 6.2 E2E-004: tenant-b 追加デプロイ

| ファイル名 | 内容 | 取得タイミング |
|----------|------|-------------|
| e2e-004-tenant-b-monitors.png | tenant-b のMonitor作成確認 | ステップ4 |

### 6.3 親子関係可視化

| ファイル名 | 内容 | 取得タイミング |
|----------|------|-------------|
| e2e-hierarchy.png | Monitors一覧（階層構造） | E2E-007 |
| e2e-composite-formula.png | Composite Monitor式 | E2E-008 |

---

## 7. 不具合管理

### 7.1 発見された不具合（実施時に記入）

| 不具合ID | 発見日 | テストID | 内容 | 優先度 | ステータス |
|---------|-------|---------|------|--------|---------|
| - | - | - | - | - | - |

---

## 8. PoCの成功基準との対応

### 8.1 成功基準マッピング

| PoCの成功基準 | 対応テストケース | 判定条件 | 実施状況 |
|------------|-------------|---------|---------|
| **アラートストーム防止** | E2E-001, E2E-002, E2E-003 | L0障害時にL2/L3アラートが抑制されること | 未実施 |
| **IaCデプロイ** | E2E-004, E2E-005, E2E-006 | tenant-b, tenant-c の追加が変数設定のみで完了すること | 未実施 |
| **親子関係の可視化** | E2E-007, E2E-008 | Datadog上で階層構造が確認できること | 未実施 |

### 8.2 成功基準判定（実施後に記入）

| 成功基準 | 判定 | 根拠 | 備考 |
|---------|------|------|------|
| アラートストーム防止 | - | - | - |
| IaCデプロイ | - | - | - |
| 親子関係の可視化 | - | - | - |

---

## 9. 合格判定

### 9.1 合格条件

**以下の全条件を満たす場合、E2Eテスト合格と判定**:
- [ ] E2E-001〜003: アラートストーム防止 成功
- [ ] E2E-004〜006: IaCデプロイ 成功
- [ ] E2E-007〜008: 親子関係可視化 確認完了
- [ ] PoCの成功基準3点全て達成
- [ ] Critical/High不具合: 0件

### 9.2 判定結果（実施後に記入）

| 判定項目 | 結果 | 備考 |
|---------|------|------|
| アラートストーム防止検証合格率 | - | - |
| IaCデプロイ検証合格率 | - | - |
| 親子関係可視化検証合格率 | - | - |
| PoCの成功基準達成 | - | - |
| Critical/High不具合数 | - | - |
| **総合判定** | **-** | **-** |

---

## 10. 改訂履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|-----------|----------|--------|
| 2025-12-28 | 1.0 | 初版作成 | QA |

---

**承認欄**:

| 役割 | 氏名 | 承認日 | サイン |
|------|------|--------|--------|
| QA | QAエージェント | 2025-12-28 | ✅ |
| PM | PMエージェント |  |  |
